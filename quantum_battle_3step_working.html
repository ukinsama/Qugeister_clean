<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Battle System - 3 Step Designer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .step-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .step-item {
            display: flex;
            align-items: center;
            margin: 0 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .step-item.active .step-number {
            background: #667eea;
            transform: scale(1.2);
        }

        .step-item.completed .step-number {
            background: #4CAF50;
        }

        .step-label {
            font-weight: 500;
            color: #999;
            transition: color 0.3s ease;
        }

        .step-item.active .step-label {
            color: #667eea;
            font-weight: bold;
        }

        .step-item.completed .step-label {
            color: #4CAF50;
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ãƒœã‚¿ãƒ³ */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        /* ã‚³ãƒ¼ãƒ‰å‡ºåŠ› */
        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            display: none;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .code-title {
            color: #4CAF50;
            font-weight: bold;
        }

        .copy-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* è¨­å®šé …ç›® */
        .setting-group {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .setting-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        .setting-item {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .setting-label {
            min-width: 150px;
            font-weight: 500;
            color: #555;
        }

        .setting-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 1em;
        }

        .setting-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .value-display {
            min-width: 60px;
            text-align: center;
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Quantum Battle System Designer</h1>
            <p>3ã‚¹ãƒ†ãƒƒãƒ—ã§AIæˆ¦ç•¥ã‚’è¨­è¨ˆãƒ»å­¦ç¿’ãƒ»å®Ÿè¡Œ</p>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="step-navigation">
            <div class="step-item active" id="nav-step1" onclick="showStep(1)">
                <div class="step-number">1</div>
                <div class="step-label">å­¦ç¿’æ–¹æ³•é¸æŠ</div>
            </div>
            <div class="step-item" id="nav-step2" onclick="showStep(2)">
                <div class="step-number">2</div>
                <div class="step-label">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ</div>
            </div>
            <div class="step-item" id="nav-step3" onclick="showStep(3)">
                <div class="step-number">3</div>
                <div class="step-label">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š</div>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: å­¦ç¿’æ–¹æ³•é¸æŠ -->
        <div class="step-content active" id="step1">
            <h2>Step 1: å­¦ç¿’æ–¹æ³•é¸æŠ</h2>
            <div class="setting-group">
                <div class="setting-title">ğŸ® å¼·åŒ–å­¦ç¿’ (Reinforcement Learning)</div>
                <p>é‡å­å›è·¯ã‚’æ´»ç”¨ã—ãŸDeep Q-Network (DQN)ã«ã‚ˆã‚Šã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè©¦è¡ŒéŒ¯èª¤ã‚’é€šã˜ã¦æœ€é©ãªæˆ¦ç•¥ã‚’å­¦ç¿’ã—ã¾ã™ã€‚</p>
                <ul style="margin: 15px 0 0 20px;">
                    <li>é‡å­æ¨å®šå™¨ã«ã‚ˆã‚‹æ•µã‚³ãƒåˆ¤åˆ¥</li>
                    <li>DQN</li>
                    <li>Îµ-greedyæ¢ç´¢æˆ¦ç•¥</li>
                </ul>
            </div>
            
            <div class="button-container">
                <button class="btn btn-success" onclick="showStep(2)">
                    ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆã¸é€²ã‚€ â†’
                </button>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ -->
        <div class="step-content" id="step2">
            <h2>Step 2: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ</h2>
            
            <div class="setting-group">
                <div class="setting-title">âš›ï¸ é‡å­æ¨å®šå™¨è¨­å®š</div>
                <div class="setting-item">
                    <label class="setting-label">é‡å­ãƒ“ãƒƒãƒˆæ•°</label>
                    <input type="range" class="slider" id="qubitsSlider" min="4" max="12" value="8" 
                           oninput="updateValue('qubits', this.value)">
                    <div class="value-display" id="qubitsValue">8</div>
                </div>
                <div class="setting-item">
                    <label class="setting-label">ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°</label>
                    <input type="range" class="slider" id="layersSlider" min="1" max="5" value="3" 
                           oninput="updateValue('layers', this.value)">
                    <div class="value-display" id="layersValue">3</div>
                </div>
            </div>

            <div class="setting-group">
                <div class="setting-title">ğŸ¯ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ</div>
                <p><strong>ç¢ºç‡çš„é‡å­æ¨å®šå™¨:</strong> 8å€‹ã®4qubitå›è·¯ã§å„æ•µã‚³ãƒã‚’ç‹¬ç«‹æ¨å®š</p>
                <p><strong>DQNå­¦ç¿’:</strong> Deep Q-Networkã«ã‚ˆã‚‹ä¾¡å€¤é–¢æ•°å­¦ç¿’</p>
                <p><strong>Îµ-greedyè¡Œå‹•é¸æŠ:</strong> æ¢ç´¢ã¨æ´»ç”¨ã®ãƒãƒ©ãƒ³ã‚¹èª¿æ•´</p>
            </div>

            <div class="button-container">
                <button class="btn btn-secondary" onclick="showStep(1)">â† æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="showStep(3)">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã¸ â†’</button>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š -->
        <div class="step-content" id="step3">
            <h2>Step 3: ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š</h2>
            
            <div class="setting-group">
                <div class="setting-title">âš™ï¸ å­¦ç¿’è¨­å®š</div>
                <div class="setting-item">
                    <label class="setting-label">å­¦ç¿’ç‡</label>
                    <input type="range" class="slider" min="-4" max="-1" value="-3" step="0.1"
                           oninput="updateLearningRate(this.value)">
                    <div class="value-display" id="lrValue">0.001</div>
                </div>
                <div class="setting-item">
                    <label class="setting-label">ãƒãƒƒãƒã‚µã‚¤ã‚º</label>
                    <select class="setting-input" id="batchSize">
                        <option value="16">16</option>
                        <option value="32" selected>32</option>
                        <option value="64">64</option>
                        <option value="128">128</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label class="setting-label">ã‚¨ãƒãƒƒã‚¯æ•°</label>
                    <input type="number" class="setting-input" id="epochs" value="100" min="10" max="1000">
                </div>
            </div>

            <div class="setting-group">
                <div class="setting-title">ğŸ® å¼·åŒ–å­¦ç¿’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</div>
                <div class="setting-item">
                    <label class="setting-label">Îµ (Epsilon)</label>
                    <input type="range" class="slider" min="0" max="1" value="0.1" step="0.01"
                           oninput="updateValue('epsilon', this.value)">
                    <div class="value-display" id="epsilonValue">0.1</div>
                </div>
                <div class="setting-item">
                    <label class="setting-label">Î³ (Gamma)</label>
                    <input type="range" class="slider" min="0.9" max="1" value="0.99" step="0.01"
                           oninput="updateValue('gamma', this.value)">
                    <div class="value-display" id="gammaValue">0.99</div>
                </div>
            </div>

            <div class="button-container">
                <button class="btn btn-secondary" onclick="showStep(2)">â† æˆ»ã‚‹</button>
                <button class="btn btn-success" onclick="generateCode()">ğŸš€ AIã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
            </div>

            <!-- ã‚³ãƒ¼ãƒ‰å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
            <div class="code-output" id="codeOutput">
                <div class="code-header">
                    <div class="code-title">ğŸ“ Generated Python Code</div>
                    <button class="copy-button" onclick="copyCode()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                </div>
                <pre id="generatedCode"></pre>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®šç®¡ç†
        const config = {
            qubits: 8,
            layers: 3,
            learningRate: 0.001,
            batchSize: 32,
            epochs: 100,
            epsilon: 0.1,
            gamma: 0.99
        };

        // ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º
        function showStep(stepNum) {
            console.log('Showing step:', stepNum);
            
            // ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’éè¡¨ç¤º
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ã™ã¹ã¦ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.remove('active', 'completed');
            });
            
            // æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤º
            const targetStep = document.getElementById(`step${stepNum}`);
            const navItem = document.getElementById(`nav-step${stepNum}`);
            
            if (targetStep) {
                targetStep.classList.add('active');
            }
            
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // å®Œäº†æ¸ˆã¿ã‚¹ãƒ†ãƒƒãƒ—ã«ãƒãƒ¼ã‚¯
            for (let i = 1; i < stepNum; i++) {
                const prevNav = document.getElementById(`nav-step${i}`);
                if (prevNav) {
                    prevNav.classList.add('completed');
                }
            }
        }

        // å€¤æ›´æ–°
        function updateValue(param, value) {
            document.getElementById(`${param}Value`).textContent = value;
            config[param] = parseFloat(value);
        }

        // å­¦ç¿’ç‡æ›´æ–°ï¼ˆå¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
        function updateLearningRate(value) {
            const lr = Math.pow(10, parseFloat(value));
            config.learningRate = lr;
            document.getElementById('lrValue').textContent = lr.toFixed(4);
        }

        // ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateCode() {
            const code = `# ============================================
# Quantum Battle System - Auto-Generated Code
# ============================================
# ç”Ÿæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}

import numpy as np
import torch
import torch.nn as nn
import torch.optim as optim
from collections import deque
import random

# ===== è¨­å®š =====
config = {
    'quantum': {
        'n_qubits': ${config.qubits},
        'n_layers': ${config.layers}
    },
    'training': {
        'learning_rate': ${config.learningRate},
        'batch_size': ${config.batchSize},
        'epochs': ${config.epochs},
        'epsilon': ${config.epsilon},
        'gamma': ${config.gamma}
    }
}

# ===== é‡å­å¼·åŒ–å­¦ç¿’AI =====
class QuantumBattleAI(nn.Module):
    def __init__(self):
        super().__init__()
        self.config = config
        
        # é‡å­æ¨å®šå™¨ï¼ˆç°¡ç•¥ç‰ˆï¼‰
        self.quantum_encoder = nn.Linear(252, self.config['quantum']['n_qubits'])
        
        # å¤å…¸çš„ãƒ‡ã‚³ãƒ¼ãƒ€
        self.classical_decoder = nn.Sequential(
            nn.Linear(self.config['quantum']['n_qubits'], 128),
            nn.ReLU(),
            nn.Dropout(0.2),
            nn.Linear(128, 64),
            nn.ReLU(),
            nn.Linear(64, 5)  # 4æ–¹å‘ + è„±å‡º
        )
    
    def forward(self, x):
        # é‡å­ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
        quantum_features = self.quantum_encoder(x)
        quantum_features = torch.tanh(quantum_features)  # æ­£è¦åŒ–
        
        # å¤å…¸çš„å‡¦ç†
        output = self.classical_decoder(quantum_features)
        return output

# ===== å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹ =====
def train_model():
    model = QuantumBattleAI()
    optimizer = optim.Adam(model.parameters(), lr=config['training']['learning_rate'])
    
    # å¼·åŒ–å­¦ç¿’è¨­å®š
    replay_buffer = deque(maxlen=10000)
    epsilon = config['training']['epsilon']
    
    print("ğŸš€ Quantum Battle AI Training Started!")
    print(f"âš›ï¸  Quantum Qubits: {config['quantum']['n_qubits']}")
    print(f"ğŸ§  Layers: {config['quantum']['n_layers']}")
    print(f"ğŸ“Š Learning Rate: {config['training']['learning_rate']}")
    print(f"ğŸ¯ Epsilon: {config['training']['epsilon']}")
    print("========================================")
    print()
    
    for episode in range(config['training']['epochs']):
        # ãƒ€ãƒŸãƒ¼å­¦ç¿’ãƒ«ãƒ¼ãƒ—ï¼ˆå®Ÿéš›ã«ã¯ã‚²ãƒ¼ãƒ ç’°å¢ƒã¨çµ±åˆï¼‰
        state = torch.randn(252)  # ãƒ€ãƒŸãƒ¼çŠ¶æ…‹
        
        # Îµ-greedyè¡Œå‹•é¸æŠ
        if random.random() < epsilon:
            action = random.choice(range(5))
        else:
            with torch.no_grad():
                q_values = model(state)
                action = q_values.argmax().item()
        
        # ãƒ€ãƒŸãƒ¼çµŒé¨“ã‚’ä¿å­˜
        reward = random.uniform(-1, 1)
        next_state = torch.randn(252)
        replay_buffer.append((state, action, reward, next_state, False))
        
        # ãƒãƒƒãƒå­¦ç¿’
        if len(replay_buffer) >= config['training']['batch_size']:
            # ç°¡ç•¥åŒ–ã—ãŸå­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—
            loss = torch.tensor(0.1)  # ãƒ€ãƒŸãƒ¼æå¤±
            optimizer.zero_grad()
            # å®Ÿéš›ã®å­¦ç¿’å‡¦ç†ã‚’ã“ã“ã«å®Ÿè£…
            optimizer.step()
        
        # Îµæ¸›è¡°
        epsilon = max(0.01, epsilon * 0.995)
        
        if episode % 10 == 0:
            print(f"Episode {episode}: Îµ = {epsilon:.4f}")
    
    return model

# ===== ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ =====
if __name__ == "__main__":
    trained_model = train_model()
    
    # ãƒ¢ãƒ‡ãƒ«ä¿å­˜
    torch.save({
        'model_state_dict': trained_model.state_dict(),
        'config': config
    }, 'quantum_battle_ai.pth')
    
    print("âœ… Training Complete! Model saved as 'quantum_battle_ai.pth'")
    print("ğŸ® Ready for battle!")`;

            document.getElementById('generatedCode').textContent = code;
            document.getElementById('codeOutput').style.display = 'block';
            document.getElementById('codeOutput').scrollIntoView({ behavior: 'smooth' });
        }

        // ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('âœ… ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }

        // åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded successfully');
            
            // åˆæœŸå€¤è¨­å®š
            updateValue('qubits', 8);
            updateValue('layers', 3);
            updateValue('epsilon', 0.1);
            updateValue('gamma', 0.99);
        });
    </script>
</body>
</html>