<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Battle System - 3 Step Designer</title>
    <!-- <link rel="stylesheet" href="styles.css"> å¤–éƒ¨CSSãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .step-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .step-item {
            display: flex;
            align-items: center;
            margin: 0 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .step-item.active .step-number {
            background: #667eea;
            transform: scale(1.2);
        }

        .step-item.completed .step-number {
            background: #4CAF50;
        }

        .step-label {
            font-weight: 500;
            color: #999;
            transition: color 0.3s ease;
        }

        .step-item.active .step-label {
            color: #667eea;
            font-weight: bold;
        }

        .step-item.completed .step-label {
            color: #4CAF50;
        }

        .step-connector {
            width: 60px;
            height: 2px;
            background: #ddd;
            margin: 0 10px;
        }

        .step-connector.completed {
            background: #4CAF50;
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—1: å­¦ç¿’æ–¹æ³•é¸æŠ */
        .learning-method-container {
            display: flex;
            flex-direction: row;
            gap: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .method-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .method-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .method-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 100%);
        }

        .method-icon {
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }

        .method-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .method-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .method-features {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            color: #555;
        }

        .feature-icon {
            color: #4CAF50;
            margin-right: 8px;
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ (Jupyter Notebook ã‚¹ã‚¿ã‚¤ãƒ«) */
        .module-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .module-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .module-card:hover {
            transform: translateY(-5px);
        }

        .module-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e9ecef;
        }

        .module-icon {
            font-size: 1.5em;
        }

        /* Jupyter Notebook ã‚¹ã‚¿ã‚¤ãƒ« */
        .notebook-cell {
            background: white;
            border-left: 4px solid #4CAF50;
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .cell-number {
            color: #888;
            font-family: monospace;
            margin-bottom: 10px;
        }

        .run-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            transition: background 0.3s ease;
        }

        .run-button:hover {
            background: #45a049;
        }

        .output-area {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }

        .module-selector {
            margin-top: 15px;
        }

        .selector-title {
            font-weight: 500;
            color: #666;
            margin-bottom: 10px;
        }

        .quantum-config {
            margin: 15px 0;
        }

        .config-item {
            margin: 15px 0;
        }

        .config-label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—3: ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š */
        .hyperparameter-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .param-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .param-section-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .param-grid {
            display: flex;
            flex-direction: column;
            gap: 25px;
            max-width: 800px;
            margin: 0 auto;
        }

        .param-item {
            display: flex;
            flex-direction: column;
        }

        .param-label {
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .param-input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .param-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .value-display {
            min-width: 60px;
            text-align: center;
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* ãƒœã‚¿ãƒ³ */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        /* ã‚³ãƒ¼ãƒ‰å‡ºåŠ› */
        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .code-title {
            color: #4CAF50;
            font-weight: bold;
        }

        .copy-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é¸æŠãƒœã‚¿ãƒ³ */
        .option-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .option-button {
            padding: 12px;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .option-button:hover {
            background: #e8ecff;
            border-color: #667eea;
        }

        .option-button.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        /* ä¿®æ­£ã•ã‚ŒãŸé…ç½®ãƒœãƒ¼ãƒ‰ */
        .placement-board {
            display: grid;
            grid-template-columns: repeat(6, 50px);
            grid-template-rows: repeat(6, 50px);
            gap: 2px;
            margin: 20px auto;
            background: #444;
            padding: 10px;
            border-radius: 10px;
            width: fit-content;
            position: relative;
        }

        .board-cell {
            background: #f0f0f0;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .board-cell:hover {
            background: #e0e0e0;
        }

        /* æ•µã‚¨ãƒªã‚¢ã®ãƒ›ãƒãƒ¼åŠ¹æœã‚’ç„¡åŠ¹åŒ– */
        .board-cell.player-b-good:hover,
        .board-cell.player-b-bad:hover {
            background: #bdbdbd;
        }
        .board-cell.player-b-bad:hover {
            background: #9e9e9e;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã®é§’è‰²åˆ†ã‘ */
        .board-cell.player-a-good { 
            background: #a5d6a7; 
            color: #2e7d32;
        }
        .board-cell.player-a-bad { 
            background: #ef9a9a; 
            color: #c62828;
        }
        .board-cell.player-b-unknown { 
            background: #bdbdbd; 
            color: #616161;
            cursor: not-allowed;
            font-weight: bold;
        }

        /* é…ç½®å¯èƒ½ã‚¨ãƒªã‚¢ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .board-cell.player-a-area {
            border: 2px dashed #4caf50;
        }
        .board-cell.player-b-area {
            border: 2px dashed #2196f3;
        }

        /* è„±å‡ºå£ã®è¡¨ç¤º */
        .board-cell.escape-a {
            background: rgba(76, 175, 80, 0.3);
        }
        .board-cell.escape-b {
            background: rgba(33, 150, 243, 0.3);
        }

        .board-legend {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .legend-item {
            display: inline-block;
            margin: 0 10px;
            padding: 3px 8px;
            border-radius: 3px;
        }

        /* ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª¬æ˜æ¬„ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .module-description {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .module-description h5 {
            color: #495057;
            margin: 0 0 10px 0;
            font-size: 1.1em;
            font-weight: 600;
        }

        .module-description textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9em;
            line-height: 1.4;
            resize: vertical;
            background: white;
            box-sizing: border-box;
        }

        .module-description textarea:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .module-description .description-hint {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }

        /* Qå€¤ãƒãƒƒãƒ—èª¬æ˜ã®åˆ‡ã‚Šæ›¿ãˆ */
        .description-variant {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .description-variant.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .qmap-output {
            margin-top: 10px;
        }
        
        .qmap-output h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .qmap-output pre {
            font-size: 11px;
            line-height: 1.4;
            color: #2c3e50;
        }

        /* èª¬æ˜æ¬„ã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ */
        .description-toggle {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            text-decoration: underline;
        }

        .description-toggle:hover {
            color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Quantum Battle System Designer</h1>
            <p>3ã‚¹ãƒ†ãƒƒãƒ—ã§AIæˆ¦ç•¥ã‚’è¨­è¨ˆãƒ»å­¦ç¿’ãƒ»å®Ÿè¡Œ</p>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="step-navigation">
            <div class="step-item active" id="nav-step1" onclick="showStep(1)">
                <div class="step-number">1</div>
                <div class="step-label">å­¦ç¿’æ–¹æ³•é¸æŠ</div>
            </div>
            <div class="step-connector" id="connector1"></div>
            <div class="step-item" id="nav-step2" onclick="showStep(2)">
                <div class="step-number">2</div>
                <div class="step-label">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ</div>
            </div>
            <div class="step-connector" id="connector2"></div>
            <div class="step-item" id="nav-step3" onclick="showStep(3)">
                <div class="step-number">3</div>
                <div class="step-label">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š</div>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: å­¦ç¿’æ–¹æ³•é¸æŠ -->
        <div class="step-content active" id="step1">
            <div class="learning-method-container">
                <div class="method-card" id="rl-card" onclick="selectLearningMethod('reinforcement')">
                    <div class="method-icon">ğŸ®</div>
                    <div class="method-title">å¼·åŒ–å­¦ç¿’</div>
                    <div class="method-description">
                        ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç’°å¢ƒã¨ç›¸äº’ä½œç”¨ã—ãªãŒã‚‰ã€è©¦è¡ŒéŒ¯èª¤ã‚’é€šã˜ã¦æœ€é©ãªæˆ¦ç•¥ã‚’å­¦ç¿’ã—ã¾ã™ã€‚
                        å®Ÿéš›ã«å¯¾æˆ¦ã‚’ç¹°ã‚Šè¿”ã—ã€å ±é…¬ã‚’æœ€å¤§åŒ–ã™ã‚‹è¡Œå‹•ã‚’ç¿’å¾—ã—ã¾ã™ã€‚
                    </div>
                    <div class="method-features">
                        <div class="feature-item">
                            <span class="feature-icon">âœ“</span>
                            è‡ªå·±å¯¾æˆ¦ã«ã‚ˆã‚‹å­¦ç¿’
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ“</span>
                            Qå­¦ç¿’
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ“</span>
                            æ¢ç´¢ã¨æ´»ç”¨ã®ãƒãƒ©ãƒ³ã‚¹
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ“</span>
                            å‹•çš„ãªæˆ¦ç•¥ã®ç²å¾—
                        </div>
                    </div>
                </div>

            </div>

            <div class="button-container">
                <button class="btn btn-primary" onclick="proceedToStep2()">æ¬¡ã¸é€²ã‚€ â†’</button>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ (Jupyter Notebook Style) -->
        <div class="step-content" id="step2">
            <div class="module-grid">
                <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«1: åˆæœŸé…ç½® -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">â™Ÿï¸</span>
                        ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«1: åˆæœŸé…ç½®æˆ¦ç•¥
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [1]:</div>
                        <p>é§’ã®åˆæœŸé…ç½®ã‚’è¨­å®šã—ã¾ã™ã€‚ã‚¯ãƒªãƒƒã‚¯ã—ã¦é…ç½®ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</p>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4>ğŸ¯ ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ã®ãƒ«ãƒ¼ãƒ«</h4>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼8é§’</strong>: å–„ç‰4å€‹ + æ‚ªç‰4å€‹</li>
                                <li><strong>è‡ªåˆ†ã®é§’ã®ã¿é…ç½®å¯èƒ½</strong>: ä¸‹å´2è¡Œã®ä¸­å¤®4åˆ—ã«é…ç½®</li>
                                <li><strong>âš ï¸ é‡è¦</strong>: ç›¸æ‰‹ã®é§’é…ç½®ã¯è¦‹ãˆã¾ã›ã‚“ï¼ˆæœªçŸ¥ï¼‰</li>
                                <li><strong>è„±å‡ºå£</strong>: ç›¸æ‰‹é™£åœ°ã®è§’ï¼ˆè–„ã„è‰²ã®ã‚»ãƒ«ï¼‰</li>
                            </ul>
                        </div>

                        <div class="placement-board" id="placementBoard"></div>
                        
                        <div class="board-legend">
                            <div class="legend-item" style="background: #a5d6a7;">Aå–„ç‰ï¼ˆç·¨é›†å¯èƒ½ï¼‰</div>
                            <div class="legend-item" style="background: #ef9a9a;">Aæ‚ªç‰ï¼ˆç·¨é›†å¯èƒ½ï¼‰</div>
                            <div class="legend-item" style="background: #bdbdbd; color: #616161; font-weight: bold;">ç›¸æ‰‹é§’?ï¼ˆæœªçŸ¥ãƒ»ç·¨é›†ä¸å¯ï¼‰</div>
                            <div class="legend-item" style="background: rgba(76, 175, 80, 0.3);">Aè„±å‡ºå£</div>
                            <div class="legend-item" style="background: rgba(33, 150, 243, 0.3);">Bè„±å‡ºå£</div>
                        </div>
                        
                        <div class="module-selector">
                            <div class="selector-title">é…ç½®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼š</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('placement', 'standard', event)">
                                    æ¨™æº–é…ç½®
                                </div>
                                <div class="option-button" onclick="selectModule('placement', 'custom', event)">
                                    ã‚«ã‚¹ã‚¿ãƒ 
                                </div>
                            </div>
                        </div>

                        <!-- èª¬æ˜æ¬„ -->
                        <div class="module-description">
                            <h5>ğŸ“ é…ç½®æˆ¦ç•¥ã®èª¬æ˜</h5>
                            <textarea id="placementDescription" placeholder="ã“ã®é…ç½®æˆ¦ç•¥ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„...&#10;ä¾‹ï¼š&#10;- å‰ç·šã«æ‚ªç‰ã‚’é…ç½®ã—ã¦ç›¸æ‰‹ã‚’èª˜å°&#10;- å–„ç‰ã‚’å¾Œæ–¹ã§å®ˆå‚™ã‚’å›ºã‚ã‚‹&#10;- è„±å‡ºã‚’ç‹™ã„ã‚„ã™ã„ä½ç½®ã«å–„ç‰ã‚’é…ç½®">ä¿®æ­£ã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œé…ç½®ï¼šã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ«æº–æ‹ 
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aã¯ä¸‹å´ï¼ˆy=4,5ï¼‰ã«é…ç½®ï¼ˆä¿®æ­£ã•ã‚ŒãŸåº§æ¨™ç³»ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Bã¯ä¸Šå´ï¼ˆy=0,1ï¼‰ã«é…ç½®
- è„±å‡ºå£ï¼šA=ç›¸æ‰‹é™£åœ°ã®ä¸Šå´è§’(0,0),(5,0)ã€B=ä¸‹å´è§’(0,5),(5,5)
- ç›¸æ‰‹ã®é§’é…ç½®ã¯å®Œå…¨ã«æœªçŸ¥ã¨ã—ã¦å­¦ç¿’</textarea>
                            <div class="description-hint">AIãŒã“ã®é…ç½®ã‚’é¸æŠã™ã‚‹ç†ç”±ã‚„æˆ¦ç•¥ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„</div>
                        </div>
                        
                        <button class="run-button" onclick="runPlacement()">â–¶ é…ç½®ã‚’å®Ÿè¡Œ</button>
                        <div class="output-area" id="placementOutput"></div>
                    </div>
                </div>

                <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«2: æ•µé§’æ¨å®š -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">ğŸ”¬</span>
                        ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«2: æ•µé§’æ¨å®šï¼ˆCQCNNï¼‰
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [2]:</div>
                        <div class="quantum-config">
                            <div class="config-item">
                                <label class="config-label">ğŸ”¢ é‡å­ãƒ“ãƒƒãƒˆæ•°ï¼ˆn_qubitsï¼‰:</label>
                                <div class="slider-container">
                                    <input type="range" class="slider" id="qubitsSlider" min="4" max="12" value="4" 
                                           oninput="updateSliderValue('qubits', this.value)">
                                    <div class="value-display" id="qubitsValue">4</div>
                                </div>
                            </div>
                            
                            <div class="config-item">
                                <label class="config-label">ğŸ“š ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ï¼ˆn_layersï¼‰:</label>
                                <div class="slider-container">
                                    <input type="range" class="slider" id="layersSlider" min="1" max="5" value="1" 
                                           oninput="updateSliderValue('layers', this.value)">
                                    <div class="value-display" id="layersValue">1</div>
                                </div>
                            </div>
                            
                            <div class="module-selector">
                                <div class="selector-title">ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°æ–¹å¼ï¼š</div>
                                <div class="option-grid">
                                    <div class="option-button selected" onclick="selectModule('embedding', 'angle', event)">
                                        ğŸ“ Angle
                                    </div>
                                    <div class="option-button" onclick="selectModule('embedding', 'amplitude', event)">
                                        ğŸ“Š Amplitude
                                    </div>
                                </div>
                            </div>
                            
                            <div class="module-selector" style="margin-top: 15px;">
                                <div class="selector-title">ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆæ§‹é€ ï¼š</div>
                                <div class="option-grid">
                                    <div class="option-button selected" onclick="selectModule('entanglement', 'linear', event)">
                                        Linear
                                    </div>
                                    <div class="option-button" onclick="selectModule('entanglement', 'full', event)">
                                        Full
                                    </div>
                                </div>
                            </div>
                            
                            <div class="module-selector" style="margin-top: 15px;">
                                <div class="selector-title">ğŸ§  çŠ¶æ…‹ãƒãƒ£ãƒ³ãƒãƒ«æ•°ï¼š</div>
                                <div class="option-grid">
                                    <div class="option-button selected" onclick="selectModule('stateChannels', '7', event)">
                                        7CH (252æ¬¡å…ƒ)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- èª¬æ˜æ¬„ -->
                        <div class="module-description">
                            <h5>ğŸ”¬ é‡å­æ¨å®šã‚·ã‚¹ãƒ†ãƒ ã®èª¬æ˜</h5>
                        </div>
                        
                        <button class="run-button" onclick="runQuantumConfig()">â–¶ é‡å­å›è·¯ã‚’æ§‹ç¯‰</button>
                        <div class="output-area" id="quantumOutput"></div>
                    </div>
                </div>

                <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«3: å ±é…¬é–¢æ•° -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">ğŸ’°</span>
                        ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«3: å ±é…¬é–¢æ•°
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [3]:</div>
                        <div class="module-selector">
                            <div class="selector-title">å ±é…¬æˆ¦ç•¥ï¼š</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('reward', 'balanced', event)">
                                    âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹
                                </div>
                            </div>
                        </div>

                        <!-- èª¬æ˜æ¬„ -->
                        <div class="module-description">
                            <h5>ğŸ’° å ±é…¬æˆ¦ç•¥ã®èª¬æ˜</h5>
                            <div class="description-content">
                                <strong>ä¿®æ­£ã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œå ±é…¬è¨­è¨ˆï¼ˆã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ«æº–æ‹ ï¼‰</strong><br>
                                â€¢ ç›¸æ‰‹ã®å–„ç‰ã‚’æ•ç²: +10ãƒã‚¤ãƒ³ãƒˆï¼ˆæœ‰åˆ©ã«ãªã‚‹ï¼‰<br>
                                â€¢ ç›¸æ‰‹ã®æ‚ªç‰ã‚’æ•ç²: -5ãƒã‚¤ãƒ³ãƒˆï¼ˆç›¸æ‰‹ã«æœ‰åˆ©ã‚’ä¸ãˆã‚‹ï¼‰<br>
                                â€¢ è„±å‡ºæˆåŠŸ: +100ãƒã‚¤ãƒ³ãƒˆï¼ˆå‹åˆ©æ¡ä»¶ï¼‰<br>
                                â€¢ å–„ç‰ãŒå–ã‚‰ã‚Œã‚‹: -20ãƒã‚¤ãƒ³ãƒˆï¼ˆä¸åˆ©ã«ãªã‚‹ï¼‰<br>
                                â€¢ æ‚ªç‰ã‚’å–ã‚‰ã›ã‚‹: +10ãƒã‚¤ãƒ³ãƒˆï¼ˆæˆ¦ç•¥çš„ä¾¡å€¤ï¼‰<br>
                                â€¢ ç›¸æ‰‹é™£åœ°ã¸ã®å‰é€²: +3ãƒã‚¤ãƒ³ãƒˆï¼ˆè„±å‡ºã¸ã®é“ç­‹ï¼‰<br>
                                â€¢ ä¸­å¤®åˆ¶å¾¡: +1ãƒã‚¤ãƒ³ãƒˆï¼ˆç›¤é¢æ”¯é…ï¼‰<br>
                                â€¢ AIãŒã©ã®ã‚ˆã†ãªè¡Œå‹•ã‚’å­¦ç¿’ã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‹é‡è¦ãªè¦ç´ ã§ã™
                            </div>
                        </div>
                        
                        <button class="run-button" onclick="runReward()">â–¶ å ±é…¬é–¢æ•°ã‚’è¨­å®š</button>
                        <div class="output-area" id="rewardOutput"></div>
                    </div>
                </div>

                <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«4: Qå€¤ãƒãƒƒãƒ— -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">ğŸ—ºï¸</span>
                        ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«4: Qå€¤
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [4]:</div>
                        <div class="module-selector">
                            <div class="selector-title">Qå€¤è¨ˆç®—æ–¹æ³•ï¼š</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('qmap', 'dqn', event)">
                                    ğŸ§  DQN
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'full_output', event)">
                                    ğŸ—ºï¸ å…¨çŠ¶æ…‹ãƒãƒƒãƒ—å‡ºåŠ›
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'heatmap_analysis', event)">
                                    ğŸ”¥ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åˆ†æ
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'strategic_pattern', event)">
                                    ğŸ¯ æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'comparative_analysis', event)">
                                    ğŸ“Š æ¯”è¼ƒåˆ†æãƒ¢ãƒ¼ãƒ‰
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'spatial_36d', event)">
                                    ğŸŒ 36æ¬¡å…ƒç©ºé–“ãƒãƒƒãƒ—
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'enhanced_cnn', event)">
                                    ğŸš€ å¼·åŒ–CNNå¯è¦–åŒ–
                                </div>
                            </div>
                        </div>

                        <!-- èª¬æ˜æ¬„ -->
                        <div class="module-description">
                            <h5>ğŸ—ºï¸ Qå€¤å­¦ç¿’æ–¹å¼ã®èª¬æ˜</h5>
                            <div class="description-content" id="qmapDescription">
                                <div id="qmap-dqn" class="description-variant active">
                                    <strong>ğŸ§  DQN (Deep Q-Network)</strong><br>
                                    â€¢ æ¨™æº–çš„ãªæ·±å±¤å¼·åŒ–å­¦ç¿’æ‰‹æ³•<br>
                                    â€¢ çµŒé¨“ãƒªãƒ—ãƒ¬ã‚¤ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨<br>
                                    â€¢ å®‰å®šã—ãŸå­¦ç¿’ã§åŸºæœ¬çš„ãªQå€¤ã‚’è¨ˆç®—<br>
                                    â€¢ ä¸€èˆ¬çš„ãªç”¨é€”ã«é©ç”¨å¯èƒ½
                                </div>
                                <div id="qmap-full_output" class="description-variant">
                                    <strong>ğŸ—ºï¸ å…¨çŠ¶æ…‹ãƒãƒƒãƒ—å‡ºåŠ›</strong><br>
                                    â€¢ <strong>ã™ã¹ã¦ã®å¯èƒ½ãªç›¤é¢çŠ¶æ…‹ã®Qå€¤ã‚’å®Œå…¨è¨ˆç®—</strong><br>
                                    â€¢ 1,000ã€œ10,000çŠ¶æ…‹ã®å¤§è¦æ¨¡åˆ†æ<br>
                                    â€¢ JSON/CSV/å¯è¦–åŒ–å½¢å¼ã§è©³ç´°å‡ºåŠ›<br>
                                    â€¢ æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åŒ…æ‹¬çš„ç†è§£ãŒå¯èƒ½<br>
                                    â€¢ <em>è¨ˆç®—æ™‚é–“: 5-15åˆ†ï¼ˆçŠ¶æ…‹æ•°ã«ã‚ˆã‚‹ï¼‰</em>
                                </div>
                                <div id="qmap-heatmap_analysis" class="description-variant">
                                    <strong>ğŸ”¥ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åˆ†æ</strong><br>
                                    â€¢ Qå€¤ã‚’è‰²åˆ†ã‘ã—ãŸè¦–è¦šçš„ãƒãƒƒãƒ—<br>
                                    â€¢ è¡Œå‹•åˆ¥ã®ä¾¡å€¤åˆ†å¸ƒã‚’ä¸€ç›®ã§æŠŠæ¡<br>
                                    â€¢ é«˜Qå€¤ã‚¨ãƒªã‚¢ã¨ä½Qå€¤ã‚¨ãƒªã‚¢ã‚’è­˜åˆ¥<br>
                                    â€¢ æˆ¦ç•¥çš„è¦åœ°ã®ç‰¹å®šã«æœ‰åŠ¹
                                </div>
                                <div id="qmap-strategic_pattern" class="description-variant">
                                    <strong>ğŸ¯ æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</strong><br>
                                    â€¢ æ”»æ’ƒå‹ãƒ»å®ˆå‚™å‹ãƒ»è„±å‡ºå‹ãƒ»ãƒãƒ©ãƒ³ã‚¹å‹ã«åˆ†é¡<br>
                                    â€¢ å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡ºç¾é »åº¦ã¨ç‰¹å¾´ã‚’åˆ†æ<br>
                                    â€¢ AIã®æˆ¦ç•¥å‚¾å‘ã‚’å®šé‡çš„ã«è©•ä¾¡<br>
                                    â€¢ å­¦ç¿’ã®åã‚Šã‚„æ”¹å–„ç‚¹ã‚’ç™ºè¦‹
                                </div>
                                <div id="qmap-comparative_analysis" class="description-variant">
                                    <strong>ğŸ“Š æ¯”è¼ƒåˆ†æãƒ¢ãƒ¼ãƒ‰</strong><br>
                                    â€¢ ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã§ã®çµæœæ¯”è¼ƒ<br>
                                    â€¢ é‡å­ãƒ“ãƒƒãƒˆæ•°ãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ã®å½±éŸ¿è©•ä¾¡<br>
                                    â€¢ å­¦ç¿’å‰å¾Œã®Qå€¤å¤‰åŒ–ã‚’è¿½è·¡<br>
                                    â€¢ æœ€é©ãªè¨­å®šã®ç™ºè¦‹ã‚’ã‚µãƒãƒ¼ãƒˆ
                                </div>
                                <div id="qmap-spatial_36d" class="description-variant">
                                    <strong>ğŸŒ 36æ¬¡å…ƒç©ºé–“ãƒãƒƒãƒ—</strong><br>
                                    â€¢ <strong>6x6ç©ºé–“ã‚°ãƒªãƒƒãƒ‰ã§Qå€¤ã‚’36æ¬¡å…ƒå‡ºåŠ›</strong><br>
                                    â€¢ å¾“æ¥ã®5è¡Œå‹•ã‹ã‚‰ç©ºé–“çš„ãªä¾¡å€¤ãƒãƒƒãƒ—ã¸é€²åŒ–<br>
                                    â€¢ ç›¤é¢ã®å„ä½ç½®ã«ãŠã‘ã‚‹ä¾¡å€¤ã‚’ç›´æ¥å¯è¦–åŒ–<br>
                                    â€¢ å±€æ‰€çš„ãªæˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ç©ºé–“åˆ†å¸ƒã‚’è§£æ<br>
                                    â€¢ <em>5è¡Œå‹•Qå€¤ã¨ã®æ¯”è¼ƒåˆ†æã‚‚åŒæ™‚å®Ÿè¡Œ</em>
                                </div>
                                <div id="qmap-enhanced_cnn" class="description-variant">
                                    <strong>ğŸš€ å¼·åŒ–CNNå¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ </strong><br>
                                    â€¢ <strong>647K+ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¶…æ·±å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</strong><br>
                                    â€¢ å‰å‡¦ç†CNN: 252â†’512â†’256â†’128â†’64â†’4æ¬¡å…ƒ<br>
                                    â€¢ é‡å­å›è·¯: 4é‡å­ãƒ“ãƒƒãƒˆãƒ»2å±¤ãƒ»ç‰¹å¾´å¢—å¼·ä»˜ã<br>
                                    â€¢ å¾Œå‡¦ç†CNN: 4â†’128â†’256â†’512â†’256â†’128â†’64â†’36æ¬¡å…ƒ<br>
                                    â€¢ <em>LayerNorm+Dropoutãƒ»201.5 FPSé«˜é€Ÿæ¨è«–</em><br>
                                    â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä¸­é–“å±¤å¯è¦–åŒ–ãƒ»å‹¾é…ãƒ•ãƒ­ãƒ¼åˆ†æ
                                </div>
                            </div>
                        </div>
                        
                        <button class="run-button" onclick="runQMap()">â–¶ Qå€¤ã‚’ç”Ÿæˆ</button>
                        <div class="output-area" id="qmapOutput"></div>
                    </div>
                </div>

                <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«5: è¡Œå‹•é¸æŠ -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">ğŸ¯</span>
                        ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«5: è¡Œå‹•é¸æŠ
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [5]:</div>
                        <div class="module-selector">
                            <div class="selector-title">è¡Œå‹•é¸æŠæˆ¦ç•¥ï¼š</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('action', 'epsilon', event)">
                                    ğŸ° Îµ-greedy
                                </div>
                            </div>
                        </div>

                        
                        <button class="run-button" onclick="runAction()">â–¶ è¡Œå‹•é¸æŠæˆ¦ç•¥ã‚’è¨­å®š</button>
                        <div class="output-area" id="actionOutput"></div>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="btn btn-secondary" onclick="showStep(1)">â† æˆ»ã‚‹</button>
                <button class="btn btn-primary" onclick="proceedToStep3()">æ¬¡ã¸é€²ã‚€ â†’</button>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š -->
        <div class="step-content" id="step3">
            <div class="hyperparameter-container">
                <!-- å­¦ç¿’è¨­å®š -->
                <div class="param-section">
                    <div class="param-section-title">
                        <span>âš™ï¸</span>
                        å­¦ç¿’è¨­å®š
                    </div>
                    <div class="param-grid">
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ“Š</span> å­¦ç¿’ç‡ (Learning Rate)
                                <small style="color: #666; font-weight: normal;">- AIã®å­¦ç¿’é€Ÿåº¦ã‚’åˆ¶å¾¡</small>
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="-4" max="-1" value="-3" step="0.1"
                                       oninput="updateLearningRate(this.value)">
                                <div class="value-display" id="lrValue">0.001</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ“¦</span> ãƒãƒƒãƒã‚µã‚¤ã‚º
                                <small style="color: #666; font-weight: normal;">- ä¸€åº¦ã«å‡¦ç†ã™ã‚‹çµŒé¨“æ•°</small>
                            </label>
                            <select class="param-input" id="batchSize">
                                <option value="4">4</option>
                                <option value="8" selected>8</option>
                                <option value="16">16</option>
                                <option value="32">32</option>
                                <option value="256">256</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ”„</span> ã‚¨ãƒãƒƒã‚¯æ•°
                                <small style="color: #666; font-weight: normal;">- å­¦ç¿’ã®ç¹°ã‚Šè¿”ã—å›æ•°</small>
                            </label>
                            <input type="number" class="param-input" id="epochs" value="5" min="1" max="1000">
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ¯</span> æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿å‰²åˆ
                                <small style="color: #666; font-weight: normal;">- å­¦ç¿’åŠ¹æœã®æ¤œè¨¼ç”¨ãƒ‡ãƒ¼ã‚¿æ¯”ç‡</small>
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0.1" max="0.4" value="0.2" step="0.05"
                                       oninput="updateSliderValue('validation', this.value)">
                                <div class="value-display" id="validationValue">0.2</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¼·åŒ–å­¦ç¿’å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ -->
                <div class="param-section" id="rlParams">
                    <div class="param-section-title">
                        <span>ğŸ®</span>
                        å¼·åŒ–å­¦ç¿’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
                    </div>
                    <div class="param-grid">
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ°</span> Îµ (Epsilon)
                                <small style="color: #666; font-weight: normal;">- ãƒ©ãƒ³ãƒ€ãƒ æ¢ç´¢ã®ç¢ºç‡</small>
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0" max="1" value="0.1" step="0.01"
                                       oninput="updateSliderValue('epsilon', this.value)">
                                <div class="value-display" id="epsilonValue">0.1</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ“‰</span> Îµæ¸›è¡°ç‡
                                <small style="color: #666; font-weight: normal;">- æ¢ç´¢ç‡ã‚’å¾ã€…ã«æ¸›ã‚‰ã™é€Ÿåº¦</small>
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0.99" max="1" value="0.995" step="0.001"
                                       oninput="updateSliderValue('epsilonDecay', this.value)">
                                <div class="value-display" id="epsilonDecayValue">0.995</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ’¾</span> ãƒªãƒ—ãƒ¬ã‚¤ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º
                                <small style="color: #666; font-weight: normal;">- éå»ã®çµŒé¨“ã‚’è¨˜æ†¶ã™ã‚‹å®¹é‡</small>
                            </label>
                            <select class="param-input" id="replayBuffer">
                                <option value="500">500</option>
                                <option value="1000" selected>1,000</option>
                                <option value="10000">10,000</option>
                                <option value="50000">50,000</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ¯</span> å‰²å¼•ç‡ (Î³)
                                <small style="color: #666; font-weight: normal;">- æœªæ¥å ±é…¬ã®é‡è¦–åº¦</small>
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0.9" max="1" value="0.99" step="0.01"
                                       oninput="updateSliderValue('gamma', this.value)">
                                <div class="value-display" id="gammaValue">0.99</div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- æœ€é©åŒ–è¨­å®š -->
                <div class="param-section">
                    <div class="param-section-title">
                        <span>ğŸš€</span>
                        æœ€é©åŒ–è¨­å®š
                    </div>
                    <div class="param-grid">
                        <div class="param-item">
                            <label class="param-label">
                                <span>âš¡</span> ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶
                                <small style="color: #666; font-weight: normal;">- é‡ã¿æ›´æ–°ã®æ–¹æ³•</small>
                            </label>
                            <select class="param-input" id="optimizer">
                                <option value="adam" selected>Adam</option>
                                <option value="sgd">SGD</option>
                                <option value="rmsprop">RMSprop</option>
                                <option value="adamw">AdamW</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ“ˆ</span> å­¦ç¿’ç‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©
                                <small style="color: #666; font-weight: normal;">- å­¦ç¿’ç‡ã®å‹•çš„èª¿æ•´</small>
                            </label>
                            <select class="param-input" id="scheduler">
                                <option value="none">ãªã—</option>
                                <option value="step">Step</option>
                                <option value="cosine" selected>Cosine</option>
                                <option value="exponential">Exponential</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ’§</span> Dropoutç‡
                                <small style="color: #666; font-weight: normal;">- éå­¦ç¿’é˜²æ­¢ã®ãŸã‚ã®ç„¡åŠ¹åŒ–ç‡</small>
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0" max="0.5" value="0.2" step="0.05"
                                       oninput="updateSliderValue('dropout', this.value)">
                                <div class="value-display" id="dropoutValue">0.2</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>ğŸ”’</span> L2æ­£å‰‡åŒ–
                                <small style="color: #666; font-weight: normal;">- é‡ã¿ã®å¤§ãã•ã«ãƒšãƒŠãƒ«ãƒ†ã‚£</small>
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="-5" max="-2" value="-4" step="0.5"
                                       oninput="updateL2Reg(this.value)">
                                <div class="value-display" id="l2Value">0.0001</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-container">
                    <button class="btn btn-secondary" onclick="showStep(2)">â† æˆ»ã‚‹</button>
                    <button class="btn btn-success" onclick="generateCode()">ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ ğŸš€</button>
                </div>
            </div>

            <!-- ã‚³ãƒ¼ãƒ‰å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
            <div class="code-output" id="codeOutput" style="display: none;">
                <div class="code-header">
                    <div class="code-title">ğŸ“ Generated Python Code</div>
                    <button class="copy-button" onclick="copyCode()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                </div>
                <pre id="generatedCode"></pre>
            </div>
        </div>

    </div>

    <style>
    </style>

    <script>
        // è¨­å®šç®¡ç†
        const config = {
            learningMethod: '',
            placement: 'standard',
            qubits: 4,
            layers: 1,
            embedding: 'angle',
            entanglement: 'linear',
            reward: 'balanced',
            qmap: 'dqn',
            action: 'epsilon',
            board: Array(6).fill().map(() => Array(6).fill(0)),
            playerAPieces: { good: [], bad: [] },
            playerBPieces: { good: [], bad: [] }
        };

        const hyperparams = {
            learningRate: 0.001,
            batchSize: 8,
            epochs: 5,
            validation: 0.2,
            epsilon: 0.1,
            epsilonDecay: 0.995,
            replayBuffer: 1000,
            gamma: 0.99,
            dropout: 0.2,
            l2Reg: 0.0001,
            optimizer: 'adam',
            scheduler: 'cosine'
        };

        // åˆæœŸåŒ–
        window.onload = () => {
            initializeBoard();
        };

        // æ­£ã—ã„ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
        function initializeBoard() {
            const board = document.getElementById('placementBoard');
            if (!board) return;
            
            board.innerHTML = '';
            
            // 6x6ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆ
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 6; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'board-cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aé…ç½®ã‚¨ãƒªã‚¢ï¼ˆä¸‹å´2è¡Œã€ä¸­å¤®4åˆ—ï¼‰
                    if ((i === 0 || i === 1) && (j >= 1 && j <= 4)) {
                        cell.classList.add('player-a-area');
                        cell.title = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aé…ç½®ã‚¨ãƒªã‚¢';
                    }
                    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Bé…ç½®ã‚¨ãƒªã‚¢ï¼ˆä¸Šå´2è¡Œã€ä¸­å¤®4åˆ—ï¼‰
                    else if ((i === 4 || i === 5) && (j >= 1 && j <= 4)) {
                        cell.classList.add('player-b-area');
                        cell.title = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Bé…ç½®ã‚¨ãƒªã‚¢';
                    }
                    
                    // è„±å‡ºå£ã®è¡¨ç¤ºï¼ˆæ­£ã—ã„ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ«ï¼‰
                    if ((i === 0 && j === 0) || (i === 0 && j === 5)) {
                        cell.classList.add('escape-a');
                        cell.title = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aè„±å‡ºå£ï¼ˆç›¸æ‰‹é™£åœ°ã®è§’ï¼‰';
                        cell.textContent = 'ğŸšª';
                    }
                    if ((i === 5 && j === 0) || (i === 5 && j === 5)) {
                        cell.classList.add('escape-b');
                        cell.title = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Bè„±å‡ºå£ï¼ˆç›¸æ‰‹é™£åœ°ã®è§’ï¼‰';
                        cell.textContent = 'ğŸšª';
                    }
                    
                    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aã‚¨ãƒªã‚¢ï¼ˆä¸‹å´2è¡Œï¼‰ã®ã¿ã‚¯ãƒªãƒƒã‚¯å¯èƒ½
                    if ((i === 0 || i === 1) && (j >= 1 && j <= 4)) {
                        cell.onclick = () => togglePiece(i, j);
                    } else if ((i === 4 || i === 5) && (j >= 1 && j <= 4)) {
                        // ç›¸æ‰‹ã‚¨ãƒªã‚¢ã«ã¯è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿
                        cell.onclick = () => {
                            alert('ç›¸æ‰‹ã®é§’ã‚¨ãƒªã‚¢ã¯ç·¨é›†ã§ãã¾ã›ã‚“ï¼ˆã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ«æº–æ‹ ï¼‰');
                        };
                    }
                    board.appendChild(cell);
                }
            }
            
            // åˆæœŸé…ç½®ã‚’è¨­å®š
            setStandardPlacement();
        }

        // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œé–¢æ•°ï¼ˆJupyter Notebook ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
        function runPlacement() {
            const output = document.getElementById('placementOutput');
            output.style.display = 'block';
            let goodCount = 0, badCount = 0;
            for (let row of config.board) {
                for (let val of row) {
                    if (val > 0) goodCount++;
                    if (val < 0) badCount++;
                }
            }
            output.textContent = `âœ… åˆæœŸé…ç½®è¨­å®šå®Œäº†
é…ç½®ã‚¿ã‚¤ãƒ—: ${config.placement}
å–„ç‰ã®ä½ç½®: ${goodCount}å€‹
æ‚ªç‰ã®ä½ç½®: ${badCount}å€‹`;
        }

        function runQuantumConfig() {
            const output = document.getElementById('quantumOutput');
            output.style.display = 'block';
            output.textContent = `âœ… é‡å­å›è·¯æ§‹ç¯‰å®Œäº†
é‡å­ãƒ“ãƒƒãƒˆæ•°: ${config.qubits}
ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${config.layers}
ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°: ${config.embedding}
ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆ: ${config.entanglement}
ç·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°: ${config.qubits * config.layers * 3}`;
        }

        function runReward() {
            const output = document.getElementById('rewardOutput');
            output.style.display = 'block';
            const rewards = {
                balanced: 'æ•ç²: +10, è„±å‡º: +50, è¢«æ•ç²: -10',
                aggressive: 'æ•ç²: +20, è„±å‡º: +30, è¢«æ•ç²: -5',
                defensive: 'æ•ç²: +5, è„±å‡º: +40, è¢«æ•ç²: -20',
                escape: 'æ•ç²: +5, è„±å‡º: +100, è¢«æ•ç²: -10'
            };
            output.textContent = `âœ… å ±é…¬é–¢æ•°è¨­å®šå®Œäº†
æˆ¦ç•¥: ${config.reward}
${rewards[config.reward]}`;
        }

        function runQMap() {
            const output = document.getElementById('qmapOutput');
            output.style.display = 'block';
            
            // Qå€¤ãƒãƒƒãƒ—ã‚¿ã‚¤ãƒ—åˆ¥ã®å‡¦ç†
            const qmapDescriptions = {
                'dqn': {
                    title: 'âœ… DQN Qå€¤ãƒãƒƒãƒ—ç”Ÿæˆå®Œäº†',
                    content: `æ–¹æ³•: Deep Q-Network
çŠ¶æ…‹ç©ºé–“: 252æ¬¡å…ƒï¼ˆ7ãƒãƒ£ãƒ³ãƒãƒ«ï¼‰
è¡Œå‹•ç©ºé–“: 5æ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³+è„±å‡ºï¼‰
æ¨å®šè¨ˆç®—æ™‚é–“: 30ç§’`
                },
                'full_output': {
                    title: 'ğŸ—ºï¸ å…¨çŠ¶æ…‹ãƒãƒƒãƒ—å‡ºåŠ›é–‹å§‹',
                    content: `ğŸš€ å®Œå…¨Qå€¤ãƒãƒƒãƒ—åˆ†æã‚’å®Ÿè¡Œä¸­...

åˆ†æå†…å®¹:
â€¢ 1,000ã€œ10,000çŠ¶æ…‹ã®å®Œå…¨è¨ˆç®—
â€¢ æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æï¼ˆæ”»æ’ƒå‹ãƒ»å®ˆå‚™å‹ãƒ»è„±å‡ºå‹ãƒ»ãƒãƒ©ãƒ³ã‚¹å‹ï¼‰
â€¢ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ç”Ÿæˆ
â€¢ JSON/CSV/å¯è¦–åŒ–å‡ºåŠ›

ğŸ’¡ ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ:
python qvalue_full_output_module.py 2

æ¨å®šæ™‚é–“: 5-15åˆ†
çµæœä¿å­˜: qvalue_analysis_results/`
                },
                'heatmap_analysis': {
                    title: 'ğŸ”¥ Qå€¤ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åˆ†æ',
                    content: `è¦–è¦šåŒ–å†…å®¹:
â€¢ 5ã¤ã®è¡Œå‹•åˆ¥Qå€¤åˆ†å¸ƒ
â€¢ é«˜ä¾¡å€¤ã‚¨ãƒªã‚¢ï¼ˆèµ¤è‰²ï¼‰ã®ç‰¹å®š
â€¢ ä½ä¾¡å€¤ã‚¨ãƒªã‚¢ï¼ˆé’è‰²ï¼‰ã®ç‰¹å®š
â€¢ æˆ¦ç•¥çš„è¦åœ°ãƒãƒƒãƒ—

å‡ºåŠ›å½¢å¼: PNG, SVG, ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–HTML`
                },
                'strategic_pattern': {
                    title: 'ğŸ¯ æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ',
                    content: `åˆ†æãƒ‘ã‚¿ãƒ¼ãƒ³:
â€¢ æ”»æ’ƒå‹: å‰é€²é‡è¦–æˆ¦ç•¥
â€¢ å®ˆå‚™å‹: å¾Œé€€ãƒ»ä¿å®ˆæˆ¦ç•¥  
â€¢ è„±å‡ºå‹: è„±å‡ºæœ€å„ªå…ˆæˆ¦ç•¥
â€¢ ãƒãƒ©ãƒ³ã‚¹å‹: çŠ¶æ³é©å¿œæˆ¦ç•¥

çµ±è¨ˆå‡ºåŠ›:
â€¢ å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡ºç¾é »åº¦
â€¢ Qå€¤åˆ†æ•£ã®æ¯”è¼ƒ
â€¢ æœ€é©æˆ¦ç•¥ã®æ¨å¥¨`
                },
                'comparative_analysis': {
                    title: 'ğŸ“Š æ¯”è¼ƒåˆ†æãƒ¢ãƒ¼ãƒ‰',
                    content: `æ¯”è¼ƒé …ç›®:
â€¢ é‡å­ãƒ“ãƒƒãƒˆæ•°ã®å½±éŸ¿ï¼ˆ2, 4, 6, 8ãƒ“ãƒƒãƒˆï¼‰
â€¢ ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ã®å½±éŸ¿ï¼ˆ1, 2, 3ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰
â€¢ å­¦ç¿’ç‡ã®å½±éŸ¿
â€¢ å­¦ç¿’å‰å¾Œã®å¤‰åŒ–è¿½è·¡

ã‚°ãƒ©ãƒ•å‡ºåŠ›:
â€¢ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆ
â€¢ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ„Ÿåº¦åˆ†æ
â€¢ åæŸé€Ÿåº¦æ¯”è¼ƒ`
                },
                'spatial_36d': {
                    title: 'ğŸŒ 36æ¬¡å…ƒç©ºé–“Qå€¤ãƒãƒƒãƒ—ç”Ÿæˆ',
                    content: `ğŸš€ æ–°ä¸–ä»£36æ¬¡å…ƒQå€¤ãƒãƒƒãƒ—åˆ†æ

å‡ºåŠ›å½¢å¼:
â€¢ 36æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ« â†’ 6x6ç©ºé–“ãƒãƒƒãƒ—å¤‰æ›
â€¢ å¾“æ¥5è¡Œå‹•Qå€¤ã¨ã®åŒæ™‚å‡ºåŠ›ãƒ»æ¯”è¼ƒ
â€¢ ç©ºé–“çš„ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆæ¤œå‡ºã¨å¯è¦–åŒ–

åˆ†æå†…å®¹:
â€¢ 6x6ã‚°ãƒªãƒƒãƒ‰å„ä½ç½®ã®ä¾¡å€¤åˆ†å¸ƒ
â€¢ ç©ºé–“åˆ†æ•£ã¨å±€æ‰€ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æ
â€¢ 5è¡Œå‹•ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æˆ¦ç•¥æ¯”è¼ƒ
â€¢ ä½ç½®åˆ¥æœ€é©è¡Œå‹•ãƒãƒƒãƒ”ãƒ³ã‚°

ğŸ’¡ å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
python qvalue_full_output_module.py 2

æ¨å®šæ™‚é–“: 5-10åˆ†
çµæœ: ç©ºé–“ãƒãƒƒãƒ—PNG + æ¯”è¼ƒåˆ†æãƒãƒ£ãƒ¼ãƒˆ`
                },
                'enhanced_cnn': {
                    title: 'ğŸš€ å¼·åŒ–CNNå¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•',
                    content: `âš¡ è¶…æ·±å±¤647K+ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†æ

ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:
â€¢ å‰å‡¦ç†CNN: 252â†’512â†’256â†’128â†’64â†’4
â€¢ é‡å­ç‰¹å¾´å¢—å¼·: 4â†’8â†’4 (2å±¤ã‚¨ãƒ³ãƒãƒ³ã‚µãƒ¼)
â€¢ é‡å­å›è·¯: 4é‡å­ãƒ“ãƒƒãƒˆãƒ»2å±¤å‡¦ç†ãƒ»cachingå¯¾å¿œ
â€¢ å¾Œå‡¦ç†CNN: 4â†’128â†’256â†’512â†’256â†’128â†’64â†’36

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:
â€¢ æ¨è«–é€Ÿåº¦: 201.5 FPS
â€¢ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 2.47 MB
â€¢ 1000ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ¨å®š: 0.1åˆ†

å¯è¦–åŒ–å†…å®¹:
â€¢ ä¸­é–“å±¤ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³åˆ†æ
â€¢ å‹¾é…ãƒ•ãƒ­ãƒ¼ãƒ»é‡ã¿åˆ†å¸ƒå¯è¦–åŒ–
â€¢ é‡å­ç‰¹å¾´ãƒãƒƒãƒ—ãƒ»ç©ºé–“Qå€¤ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¨è«–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

ğŸ’¡ å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
python test_enhanced_cnn.py

æ¨å®šæ™‚é–“: 1-2åˆ†
çµæœ: å®Œå…¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ†æãƒ¬ãƒãƒ¼ãƒˆ`
                }
            };
            
            const description = qmapDescriptions[config.qmap] || qmapDescriptions['dqn'];
            
            output.innerHTML = `<div class="qmap-output">
                <h4>${description.title}</h4>
                <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 12px;">${description.content}</pre>
                ${(config.qmap === 'full_output' || config.qmap === 'spatial_36d' || config.qmap === 'enhanced_cnn') ? 
                    `<div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="executeQMapAnalysis()" style="margin-right: 10px;">
                            ğŸš€ åˆ†æå®Ÿè¡Œ
                        </button>
                        <button class="btn btn-secondary" onclick="viewPreviousResults()">
                            ğŸ“ éå»ã®çµæœã‚’è¡¨ç¤º
                        </button>
                        ${config.qmap === 'spatial_36d' ? 
                            `<button class="btn btn-info" onclick="showSpatialMapInfo()" style="margin-left: 10px;">
                                ğŸŒ 36æ¬¡å…ƒãƒãƒƒãƒ—è©³ç´°
                            </button>` : ''
                        }
                        ${config.qmap === 'enhanced_cnn' ? 
                            `<button class="btn btn-warning" onclick="showEnhancedCNNDetails()" style="margin-left: 10px;">
                                ğŸš€ CNNè©³ç´°åˆ†æ
                            </button>
                            <button class="btn btn-success" onclick="runRealTimeVisualization()" style="margin-left: 10px;">
                                ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–
                            </button>` : ''
                        }
                    </div>` : ''
                }
            </div>`;
        }
        
        function executeQMapAnalysis() {
            const output = document.getElementById('qmapOutput');
            const analyzeType = config.qmap === 'spatial_36d' ? '36æ¬¡å…ƒç©ºé–“Qå€¤ãƒãƒƒãƒ—' : 'Qå€¤ãƒãƒƒãƒ—';
            
            output.innerHTML += `
                <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px; border-left: 4px solid #2196f3;">
                    <strong>ğŸ“Š ${analyzeType}å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong><br>
                    1. å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ç¢ºèªä¸­...<br>
                    2. ç›¤é¢çŠ¶æ…‹ç”Ÿæˆä¸­...<br>
                    3. ${config.qmap === 'spatial_36d' ? '36æ¬¡å…ƒQå€¤è¨ˆç®—å®Ÿè¡Œä¸­...<br>4. 6x6ç©ºé–“ãƒãƒƒãƒ—å¤‰æ›ä¸­...<br>5. 5è¡Œå‹•Qå€¤æ¯”è¼ƒå®Ÿè¡Œä¸­...' : 'Qå€¤è¨ˆç®—å®Ÿè¡Œä¸­...<br>4. æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æä¸­...'}<br>
                    ${config.qmap === 'spatial_36d' ? '6. ç©ºé–“ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆè§£æä¸­...<br>7. å¯è¦–åŒ–ç”Ÿæˆä¸­...' : '5.'} çµæœå‡ºåŠ›ä¸­...<br><br>
                    
                    <em>ğŸ’¡ å®Ÿéš›ã®å®Ÿè¡Œã¯ã€fast_quantum_trainer.pyã§å­¦ç¿’å®Œäº†å¾Œã«è¡Œã£ã¦ãã ã•ã„ã€‚</em><br>
                    <code>python qvalue_full_output_module.py</code>
                    ${config.qmap === 'spatial_36d' ? '<br><em>â€» 36æ¬¡å…ƒç©ºé–“ãƒãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ã§ã¯è¿½åŠ ã®å¯è¦–åŒ–ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™</em>' : ''}
                </div>`;
        }
        
        function showSpatialMapInfo() {
            const output = document.getElementById('qmapOutput');
            output.innerHTML += `
                <div style="margin-top: 15px; padding: 15px; background: #f3e5f5; border-radius: 8px; border: 2px solid #9c27b0;">
                    <h5 style="color: #7b1fa2; margin-bottom: 10px;">ğŸŒ 36æ¬¡å…ƒç©ºé–“Qå€¤ãƒãƒƒãƒ—è©³ç´°è§£èª¬</h5>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <h6 style="color: #4a148c;">ğŸ“ æŠ€è¡“ä»•æ§˜:</h6>
                            <ul style="font-size: 12px; margin: 5px 0;">
                                <li>å‡ºåŠ›æ¬¡å…ƒ: 36 (6Ã—6ã‚°ãƒªãƒƒãƒ‰)</li>
                                <li>å…¥åŠ›: 252æ¬¡å…ƒ (7ãƒãƒ£ãƒ³ãƒãƒ«)</li>
                                <li>é‡å­ãƒ“ãƒƒãƒˆ: 4é‡å­ãƒ“ãƒƒãƒˆ</li>
                                <li>å¾Œå‡¦ç†: 4â†’32â†’36æ¬¡å…ƒ</li>
                            </ul>
                        </div>
                        <div>
                            <h6 style="color: #4a148c;">ğŸ“Š å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«:</h6>
                            <ul style="font-size: 12px; margin: 5px 0;">
                                <li>*_spatial.png: 9å€‹ã‚µãƒ³ãƒ—ãƒ«ç©ºé–“ãƒãƒƒãƒ—</li>
                                <li>*_comparison.png: 5è¡Œå‹•vs36æ¬¡å…ƒæ¯”è¼ƒ</li>
                                <li>JSON: ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆåº§æ¨™ãƒ‡ãƒ¼ã‚¿</li>
                                <li>CSV: ç©ºé–“åˆ†æ•£çµ±è¨ˆ</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="background: #fce4ec; padding: 10px; border-radius: 5px; font-size: 12px;">
                        <strong>ğŸ”¬ åˆ†æãƒã‚¤ãƒ³ãƒˆ:</strong><br>
                        â€¢ 6Ã—6ã‚°ãƒªãƒƒãƒ‰ã®å„ã‚»ãƒ«ãŒç›¤é¢ä½ç½®ã®ä¾¡å€¤ã‚’è¡¨ç¾<br>
                        â€¢ å¾“æ¥ã®ä¸Šä¸‹å·¦å³è„±å‡º(5è¡Œå‹•)ã‚’ç©ºé–“çš„ã«æ‹¡å¼µ<br>
                        â€¢ å±€æ‰€çš„ãªä¾¡å€¤ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å¤§åŸŸçš„æˆ¦ç•¥ã®ä¸¡æ–¹ã‚’å¯è¦–åŒ–<br>
                        â€¢ AIãŒã€Œã©ã®ä½ç½®ã‚’é‡è¦è¦–ã™ã‚‹ã‹ã€ã‚’ç›´æ¥è¦³å¯Ÿå¯èƒ½
                    </div>
                </div>`;
        }
        
        function showEnhancedCNNDetails() {
            const output = document.getElementById('qmapOutput');
            output.innerHTML += `
                <div style="margin-top: 15px; padding: 20px; background: #e8f5e8; border-radius: 12px; border: 3px solid #4caf50;">
                    <h5 style="color: #2e7d32; margin-bottom: 15px;">ğŸš€ å¼·åŒ–CNNè©³ç´°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ†æ</h5>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <h6 style="color: #1b5e20;">ğŸ§  å‰å‡¦ç†CNN:</h6>
                            <ul style="font-size: 11px; margin: 5px 0;">
                                <li>Layer 1: 252â†’512 (LayerNorm+ReLU+Dropout 0.2)</li>
                                <li>Layer 2: 512â†’256 (LayerNorm+ReLU+Dropout 0.15)</li>
                                <li>Layer 3: 256â†’128 (LayerNorm+ReLU+Dropout 0.1)</li>
                                <li>Layer 4: 128â†’64 (LayerNorm+ReLU+Dropout 0.05)</li>
                                <li>Layer 5: 64â†’4 (Tanh é‡å­æ­£è¦åŒ–)</li>
                            </ul>
                        </div>
                        <div>
                            <h6 style="color: #1b5e20;">âš›ï¸ é‡å­å‡¦ç†:</h6>
                            <ul style="font-size: 11px; margin: 5px 0;">
                                <li>é‡å­ç‰¹å¾´å¢—å¼·: 4â†’8â†’4</li>
                                <li>é‡å­å›è·¯: 4é‡å­ãƒ“ãƒƒãƒˆãƒ»2å±¤</li>
                                <li>ãƒ‡ãƒã‚¤ã‚¹: Lightning.qubit (fallback: default)</li>
                                <li>ã‚­ãƒ£ãƒƒã‚·ãƒ¥: LRU 10,000ã‚µãƒ³ãƒ—ãƒ«</li>
                                <li>äº‹å‰è¨ˆç®—ãƒ‘ã‚¿ãƒ¼ãƒ³: 3ç¨®é¡</li>
                            </ul>
                        </div>
                        <div>
                            <h6 style="color: #1b5e20;">ğŸ¯ å¾Œå‡¦ç†CNN:</h6>
                            <ul style="font-size: 11px; margin: 5px 0;">
                                <li>Layer 1: 4â†’128 (LayerNorm+ReLU+Dropout 0.1)</li>
                                <li>Layer 2: 128â†’256â†’512 (æ‹¡å¼µ)</li>
                                <li>Layer 3-5: 512â†’256â†’128â†’64 (åæŸ)</li>
                                <li>Output: 64â†’36 (Tanhæ­£è¦åŒ–)</li>
                                <li>ç©ºé–“å½¢çŠ¶: 6Ã—6 Qå€¤ãƒãƒƒãƒ—</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: #c8e6c9; padding: 10px; border-radius: 8px;">
                            <strong style="color: #2e7d32;">âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™:</strong><br>
                            <span style="font-size: 12px;">
                                â€¢ ç·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: 647,044å€‹<br>
                                â€¢ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 2.47 MB<br>
                                â€¢ æ¨è«–é€Ÿåº¦: 201.5 FPS<br>
                                â€¢ ãƒãƒƒãƒæ¨è«–: 0.0056ç§’/ã‚µãƒ³ãƒ—ãƒ«<br>
                                â€¢ 1000ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰: 0.1åˆ†ï¼ˆæ¨å®šï¼‰
                            </span>
                        </div>
                        <div style="background: #dcedc8; padding: 10px; border-radius: 8px;">
                            <strong style="color: #33691e;">ğŸ”¬ å¯è¦–åŒ–æ©Ÿèƒ½:</strong><br>
                            <span style="font-size: 12px;">
                                â€¢ ä¸­é–“å±¤ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³åˆ†æ<br>
                                â€¢ å‹¾é…ãƒ•ãƒ­ãƒ¼å¯è¦–åŒ–<br>
                                â€¢ é‡ã¿åˆ†å¸ƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ <br>
                                â€¢ é‡å­ç‰¹å¾´ãƒãƒƒãƒ—è¡¨ç¤º<br>
                                â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¨è«–ç›£è¦–
                            </span>
                        </div>
                    </div>
                </div>`;
        }
        
        function runRealTimeVisualization() {
            const output = document.getElementById('qmapOutput');
            output.innerHTML += `
                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 10px; border: 2px solid #2196f3;">
                    <h5 style="color: #1976d2; margin-bottom: 10px;">ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­...</h5>
                    
                    <div style="margin-bottom: 15px;">
                        <div style="background: #bbdefb; padding: 8px; border-radius: 5px; margin: 5px 0;">
                            <strong>ğŸ”„ 1/6: ãƒ¢ãƒ‡ãƒ«åˆæœŸåŒ–ä¸­...</strong> <span style="color: #4caf50;">âœ… å®Œäº†</span><br>
                            <small>â€¢ 647K+ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†</small>
                        </div>
                        <div style="background: #bbdefb; padding: 8px; border-radius: 5px; margin: 5px 0;">
                            <strong>ğŸ”„ 2/6: å¯è¦–åŒ–ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•ä¸­...</strong> <span style="color: #ff9800;">â³ å‡¦ç†ä¸­</span><br>
                            <small>â€¢ ä¸­é–“å±¤ãƒ•ãƒƒã‚¯è¨­å®šãƒ»å‹¾é…ç›£è¦–æº–å‚™</small>
                        </div>
                        <div style="background: #e1f5fe; padding: 8px; border-radius: 5px; margin: 5px 0;">
                            <strong>ğŸ”„ 3/6: ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ä¸­...</strong> <span style="color: #9e9e9e;">â¸ï¸ å¾…æ©Ÿä¸­</span><br>
                            <small>â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æº–å‚™</small>
                        </div>
                        <div style="background: #e1f5fe; padding: 8px; border-radius: 5px; margin: 5px 0;">
                            <strong>ğŸ”„ 4/6: Webå¯è¦–åŒ–ã‚µãƒ¼ãƒãƒ¼èµ·å‹•...</strong> <span style="color: #9e9e9e;">â¸ï¸ å¾…æ©Ÿä¸­</span><br>
                            <small>â€¢ WebSocketæ¥ç¶šãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°æº–å‚™</small>
                        </div>
                        <div style="background: #e1f5fe; padding: 8px; border-radius: 5px; margin: 5px 0;">
                            <strong>ğŸ”„ 5/6: é‡å­çŠ¶æ…‹ç›£è¦–é–‹å§‹...</strong> <span style="color: #9e9e9e;">â¸ï¸ å¾…æ©Ÿä¸­</span><br>
                            <small>â€¢ é‡å­å›è·¯çŠ¶æ…‹ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ç›£è¦–</small>
                        </div>
                        <div style="background: #e1f5fe; padding: 8px; border-radius: 5px; margin: 5px 0;">
                            <strong>ğŸ”„ 6/6: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º...</strong> <span style="color: #9e9e9e;">â¸ï¸ å¾…æ©Ÿä¸­</span><br>
                            <small>â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–ç”»é¢è¡¨ç¤º</small>
                        </div>
                    </div>
                    
                    <div style="background: #f3e5f5; padding: 12px; border-radius: 8px; border-left: 4px solid #9c27b0;">
                        <strong>ğŸ’¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–æ©Ÿèƒ½:</strong><br>
                        <span style="font-size: 12px;">
                            â€¢ <strong>æ¨è«–ç›£è¦–:</strong> FPSãƒ»ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ»ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ<br>
                            â€¢ <strong>ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³:</strong> å„å±¤ã®å‡ºåŠ›åˆ†å¸ƒãƒ»çµ±è¨ˆ<br>
                            â€¢ <strong>å‹¾é…åˆ†æ:</strong> é€†ä¼æ’­ãƒ•ãƒ­ãƒ¼ãƒ»å‹¾é…ãƒãƒ«ãƒ <br>
                            â€¢ <strong>é‡å­çŠ¶æ…‹:</strong> é‡å­ãƒ“ãƒƒãƒˆçŠ¶æ…‹ãƒ»ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆ<br>
                            â€¢ <strong>Qå€¤ãƒãƒƒãƒ—:</strong> 6Ã—6ç©ºé–“ä¾¡å€¤åˆ†å¸ƒãƒ»ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆ<br>
                            â€¢ <strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨:</strong> GPU/CPUä½¿ç”¨ç‡ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹
                        </span>
                    </div>
                </div>`;
                
            // Simulate loading progress
            setTimeout(() => {
                const elements = output.querySelectorAll('[style*="â³ å‡¦ç†ä¸­"]');
                if (elements.length > 0) {
                    elements[0].innerHTML = '<span style="color: #4caf50;">âœ… å®Œäº†</span>';
                    elements[0].parentElement.style.background = '#c8e6c9';
                    
                    const nextElement = elements[0].parentElement.nextElementSibling;
                    if (nextElement) {
                        nextElement.querySelector('span').innerHTML = '<span style="color: #ff9800;">â³ å‡¦ç†ä¸­</span>';
                        nextElement.style.background = '#bbdefb';
                    }
                }
            }, 2000);
        }
        
        function viewPreviousResults() {
            const output = document.getElementById('qmapOutput');
            output.innerHTML += `
                <div style="margin-top: 15px; padding: 10px; background: #f3e5f5; border-radius: 5px; border-left: 4px solid #9c27b0;">
                    <strong>ğŸ“‚ éå»ã®åˆ†æçµæœ:</strong><br>
                    â€¢ qvalue_analysis_results/qvalue_full_output.json<br>
                    â€¢ qvalue_analysis_results/qvalue_heatmap.png<br>
                    â€¢ qvalue_analysis_results/qvalue_summary.csv<br>
                    â€¢ qvalue_analysis_results/qvalue_complete_data.pkl<br><br>
                    
                    <em>çµæœãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã§ãã¾ã™ã€‚</em>
                </div>`;
        }

        function runAction() {
            const output = document.getElementById('actionOutput');
            output.style.display = 'block';
            const strategies = {
                epsilon: 'Îµ=0.1ã§10%ã®ç¢ºç‡ã§ãƒ©ãƒ³ãƒ€ãƒ æ¢ç´¢',
                boltzmann: 'æ¸©åº¦Ï„=1.0ã§ã‚½ãƒ•ãƒˆãƒãƒƒã‚¯ã‚¹é¸æŠ',
                ucb: 'ä¿¡é ¼åŒºé–“ã«ã‚ˆã‚‹æ¥½è¦³çš„æ¢ç´¢',
                thompson: 'ãƒ™ã‚¤ã‚ºçš„ç¢ºç‡åˆ†å¸ƒã‹ã‚‰ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°'
            };
            output.textContent = `âœ… è¡Œå‹•é¸æŠæˆ¦ç•¥è¨­å®šå®Œäº†
æˆ¦ç•¥: ${config.action}
${strategies[config.action]}`;
        }

        // æ¨™æº–é…ç½®ã®è¨­å®š
        function setStandardPlacement() {
            // ãƒœãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            config.board = Array(6).fill().map(() => Array(6).fill(0));
            config.playerAPieces = { good: [], bad: [] };
            config.playerBPieces = { good: [], bad: [] };
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼A: ä¸‹å´2è¡Œï¼ˆ0-1è¡Œï¼‰ä¸­å¤®4åˆ—ï¼ˆ1-4åˆ—ï¼‰ã«ãƒ©ãƒ³ãƒ€ãƒ é…ç½®
            const playerAPositions = [
                [0, 1], [0, 2], [0, 3], [0, 4],
                [1, 1], [1, 2], [1, 3], [1, 4]
            ];
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼B: ä¸Šå´2è¡Œï¼ˆ4-5è¡Œï¼‰ä¸­å¤®4åˆ—ï¼ˆ1-4åˆ—ï¼‰ - ã‚°ãƒ¬ãƒ¼é§’ã¨ã—ã¦è¡¨ç¤º
            const playerBPositions = [
                [4, 1], [4, 2], [4, 3], [4, 4],
                [5, 1], [5, 2], [5, 3], [5, 4]
            ];
            
            // é§’ã®ç¨®é¡ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®ï¼ˆå–„ç‰4å€‹ã€æ‚ªç‰4å€‹ï¼‰
            const pieceTypes = ['good', 'good', 'good', 'good', 'bad', 'bad', 'bad', 'bad'];
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aã®é…ç½®ï¼ˆç·¨é›†å¯èƒ½ï¼‰
            const shuffledTypesA = [...pieceTypes].sort(() => Math.random() - 0.5);
            playerAPositions.forEach(([row, col], index) => {
                const type = shuffledTypesA[index];
                config.board[row][col] = type === 'good' ? 1 : -1; // Aå–„ç‰=1, Aæ‚ªç‰=-1
                config.playerAPieces[type].push([row, col]);
            });
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Bã®é…ç½®ï¼ˆå†…éƒ¨ã§ã®ã¿ç®¡ç†ã€è¡¨ç¤ºã¯å…¨ã¦ã‚°ãƒ¬ãƒ¼é§’ï¼‰
            const shuffledTypesB = [...pieceTypes].sort(() => Math.random() - 0.5);
            playerBPositions.forEach(([row, col], index) => {
                const type = shuffledTypesB[index];
                // ãƒœãƒ¼ãƒ‰ã«ã¯æœªçŸ¥é§’ã¨ã—ã¦çµ±ä¸€å€¤ã‚’è¨­å®šï¼ˆç¨®é¡ã‚’éš è”½ï¼‰
                config.board[row][col] = 9; // 9 = ç›¸æ‰‹ã®é§’ï¼ˆç¨®é¡ä¸æ˜ï¼‰
                config.playerBPieces[type].push([row, col]);
            });
            
            updateBoardDisplay();
        }

        // ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã®æ›´æ–°
        function updateBoardDisplay() {
            const board = document.getElementById('placementBoard');
            const cells = board.querySelectorAll('.board-cell');
            
            cells.forEach((cell, index) => {
                const row = Math.floor(index / 6);
                const col = index % 6;
                const value = config.board[row][col];
                
                // æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚’ä¿æŒã—ã¤ã¤ã€é§’ã®çŠ¶æ…‹ã‚’æ›´æ–°
                cell.className = 'board-cell';
                
                // ã‚¨ãƒªã‚¢è¡¨ç¤ºã‚’å†è¿½åŠ 
                if ((row === 0 || row === 1) && (col >= 1 && col <= 4)) {
                    cell.classList.add('player-a-area');
                }
                else if ((row === 4 || row === 5) && (col >= 1 && col <= 4)) {
                    cell.classList.add('player-b-area');
                }
                
                // è„±å‡ºå£è¡¨ç¤ºã‚’å†è¿½åŠ ï¼ˆæ­£ã—ã„ãƒ«ãƒ¼ãƒ«ï¼‰
                if ((row === 0 && col === 0) || (row === 0 && col === 5)) {
                    cell.classList.add('escape-a');
                    if (value === 0) cell.textContent = 'ğŸšª';
                }
                if ((row === 5 && col === 0) || (row === 5 && col === 5)) {
                    cell.classList.add('escape-b');
                    if (value === 0) cell.textContent = 'ğŸšª';
                }
                
                // é§’ã®è¡¨ç¤º
                if (value === 1) {
                    cell.classList.add('player-a-good');
                    cell.textContent = 'â—‹';
                    cell.title = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼A å–„ç‰ï¼ˆç·¨é›†å¯èƒ½ï¼‰';
                } else if (value === -1) {
                    cell.classList.add('player-a-bad');
                    cell.textContent = 'â—';
                    cell.title = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼A æ‚ªç‰ï¼ˆç·¨é›†å¯èƒ½ï¼‰';
                } else if (value === 9) {
                    // ç›¸æ‰‹ã®é§’ã¯å…¨ã¦æœªçŸ¥ã®ã‚°ãƒ¬ãƒ¼é§’ã¨ã—ã¦è¡¨ç¤º
                    cell.classList.add('player-b-unknown');
                    cell.textContent = '?';
                    cell.title = 'ç›¸æ‰‹ã®é§’ï¼ˆå–„ç‰/æ‚ªç‰ä¸æ˜ãƒ»ç·¨é›†ä¸å¯ï¼‰';
                }
            });
        }

        // ãƒ”ãƒ¼ã‚¹åˆ‡ã‚Šæ›¿ãˆï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰æ™‚ï¼‰
        function togglePiece(row, col) {
            if (config.placement !== 'custom') {
                alert('ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ã‹ã‚‰é§’ã‚’ç·¨é›†ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aã‚¨ãƒªã‚¢ã®ç¢ºèªï¼ˆä¸‹å´2è¡Œã®ä¸­å¤®4åˆ—ã®ã¿ï¼‰
            const isPlayerAArea = (row === 0 || row === 1) && (col >= 1 && col <= 4);
            
            if (!isPlayerAArea) {
                alert('ã“ã®ä½ç½®ã«ã¯é§’ã‚’é…ç½®ã§ãã¾ã›ã‚“ï¼ˆã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ«æº–æ‹ ï¼‰');
                return;
            }
            
            const current = config.board[row][col];
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aã‚¨ãƒªã‚¢ã®ã¿ç·¨é›†å¯èƒ½: 0 â†’ 1(å–„ç‰) â†’ -1(æ‚ªç‰) â†’ 0
            const next = current === 0 ? 1 : current === 1 ? -1 : 0;
            
            config.board[row][col] = next;
            updateBoardDisplay();
        }

        // å­¦ç¿’æ–¹æ³•é¸æŠ
        function selectLearningMethod(method) {
            config.learningMethod = method;
            
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            if (method === 'reinforcement') {
                document.getElementById('rl-card').classList.add('selected');
            } else {
                document.getElementById('sl-card').classList.add('selected');
            }
        }

        // ã‚¹ãƒ†ãƒƒãƒ—2ã¸é€²ã‚€
        function proceedToStep2() {
            console.log('proceedToStep2 called');
            // å¼·åˆ¶çš„ã«å¼·åŒ–å­¦ç¿’ã‚’è¨­å®š
            config.learningMethod = 'reinforcement';
            console.log('Set learningMethod to:', config.learningMethod);
            // ç›´æ¥Step2ã‚’è¡¨ç¤º
            showStep(2);
        }

        // ã‚¹ãƒ†ãƒƒãƒ—3ã¸é€²ã‚€
        function proceedToStep3() {
            console.log('proceedToStep3 called');
            showStep(3);
            // å¼·åŒ–å­¦ç¿’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
            const rlParams = document.getElementById('rlParams');
            if (rlParams) {
                rlParams.style.display = 'block';
            }
        }

        // ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º
        function showStep(stepNum) {
            console.log('showStep called with:', stepNum);
            
            // ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’éè¡¨ç¤º
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ã™ã¹ã¦ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.remove('active', 'completed');
            });
            
            // æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤º
            const targetStep = document.getElementById(`step${stepNum}`);
            const navItem = document.getElementById(`nav-step${stepNum}`);
            
            if (targetStep) {
                targetStep.classList.add('active');
                console.log('Added active to:', targetStep.id);
            }
            
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // å®Œäº†æ¸ˆã¿ã‚¹ãƒ†ãƒƒãƒ—ã«ãƒãƒ¼ã‚¯
            for (let i = 1; i < stepNum; i++) {
                const prevNav = document.getElementById(`nav-step${i}`);
                const connector = document.getElementById(`connector${i}`);
                if (prevNav) {
                    prevNav.classList.add('completed');
                }
                if (connector) {
                    connector.classList.add('completed');
                }
            }
        }


        // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é¸æŠ
        function selectModule(type, value, event) {
            config[type] = value;
            
            // ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
            const container = event.target.parentElement;
            container.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // é…ç½®ã‚¿ã‚¤ãƒ—ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€ãƒœãƒ¼ãƒ‰ã‚’æ›´æ–°
            if (type === 'placement') {
                if (value === 'standard') {
                    setStandardPlacement();
                } else if (value === 'aggressive') {
                    setAggressivePlacement();
                } else if (value === 'defensive') {
                    setDefensivePlacement();
                }
                // customã®å ´åˆã¯ç¾åœ¨ã®é…ç½®ã‚’ä¿æŒ
            }
            
            // Qå€¤ãƒãƒƒãƒ—ã®èª¬æ˜åˆ‡ã‚Šæ›¿ãˆ
            if (type === 'qmap') {
                document.querySelectorAll('.description-variant').forEach(desc => {
                    desc.classList.remove('active');
                });
                const targetDesc = document.getElementById(`qmap-${value}`);
                if (targetDesc) {
                    targetDesc.classList.add('active');
                }
            }
        }
        
        // æ”»æ’ƒçš„é…ç½®
        function setAggressivePlacement() {
            setStandardPlacement(); // ã¾ãšæ¨™æº–é…ç½®ã‚’ä½œæˆ
            // å®Ÿéš›ã®æ”»æ’ƒçš„é…ç½®ãƒ­ã‚¸ãƒƒã‚¯ã¯æ¨™æº–é…ç½®ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã™ã‚‹
        }

        // é˜²å¾¡çš„é…ç½®
        function setDefensivePlacement() {
            setStandardPlacement(); // ã¾ãšæ¨™æº–é…ç½®ã‚’ä½œæˆ
            // å®Ÿéš›ã®é˜²å¾¡çš„é…ç½®ãƒ­ã‚¸ãƒƒã‚¯ã¯æ¨™æº–é…ç½®ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã™ã‚‹
        }

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤æ›´æ–°
        function updateSliderValue(param, value) {
            document.getElementById(`${param}Value`).textContent = value;
            if (param === 'qubits' || param === 'layers') {
                config[param] = parseInt(value);
            } else {
                hyperparams[param] = parseFloat(value);
            }
        }

        // å­¦ç¿’ç‡æ›´æ–°ï¼ˆå¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
        function updateLearningRate(value) {
            const lr = Math.pow(10, parseFloat(value));
            hyperparams.learningRate = lr;
            document.getElementById('lrValue').textContent = lr.toFixed(4);
        }

        // L2æ­£å‰‡åŒ–æ›´æ–°ï¼ˆå¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
        function updateL2Reg(value) {
            const l2 = Math.pow(10, parseFloat(value));
            hyperparams.l2Reg = l2;
            document.getElementById('l2Value').textContent = l2.toFixed(5);
        }

        // ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateCode() {
            console.log('generateCode called');
            
            // ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—
            const batchSize = document.getElementById('batchSize')?.value || '32';
            const epochs = document.getElementById('epochs')?.value || '100';
            const optimizer = document.getElementById('optimizer')?.value || 'adam';
            const scheduler = document.getElementById('scheduler')?.value || 'cosine';
            const replayBuffer = document.getElementById('replayBuffer')?.value || '10000';
            
            console.log('Parameters collected:', {batchSize, epochs, optimizer, scheduler});
            
            // èª¬æ˜æ¬„ã®å†…å®¹ã‚’å–å¾—
            const placementDesc = document.getElementById('placementDescription')?.value || 
                                'ä¿®æ­£ã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œé…ç½®ï¼šã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ«æº–æ‹ ';
            const quantumDesc = 'ç¢ºç‡çš„é‡å­æ¨å®šå™¨ã«ã‚ˆã‚‹æ•µã‚³ãƒã®å–„ç‰/æ‚ªç‰ç¢ºç‡æ¨å®š';
            const rewardDesc = 'ãƒãƒ©ãƒ³ã‚¹å‹å ±é…¬é–¢æ•°ï¼šæ•ç²ãƒ»è„±å‡ºãƒ»æˆ¦ç•¥çš„è¡Œå‹•ã‚’ç·åˆè©•ä¾¡';
            const qmapDesc = 'DQNã«ã‚ˆã‚‹Qå€¤å­¦ç¿’ï¼šæ·±å±¤å¼·åŒ–å­¦ç¿’ã§ä¾¡å€¤é–¢æ•°ã‚’è¿‘ä¼¼';
            const actionDesc = 'Îµ-greedyæˆ¦ç•¥ï¼šæ¢ç´¢ã¨æ´»ç”¨ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å‹•çš„èª¿æ•´';

            const code = `# ============================================
# Quantum Battle System - Auto-Generated Code
# ============================================
# å­¦ç¿’æ–¹æ³•: ${config.learningMethod === 'reinforcement' ? 'å¼·åŒ–å­¦ç¿’' : 'æ•™å¸«ã‚ã‚Šå­¦ç¿’'}
# ç”Ÿæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}
#
# ===== AIè¨­è¨ˆèª¬æ˜ =====
# 
# ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«1: åˆæœŸé…ç½®æˆ¦ç•¥ã€‘
${placementDesc.split('\n').map(line => '# ' + line).join('\n')}
# 
# ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«2: é‡å­æ¨å®šã‚·ã‚¹ãƒ†ãƒ ã€‘  
${quantumDesc.split('\n').map(line => '# ' + line).join('\n')}
# 
# ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«3: å ±é…¬æˆ¦ç•¥ã€‘
${rewardDesc.split('\n').map(line => '# ' + line).join('\n')}
# 
# ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«4: Qå€¤å­¦ç¿’æ–¹å¼ã€‘
${qmapDesc.split('\n').map(line => '# ' + line).join('\n')}
# 
# ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«5: è¡Œå‹•é¸æŠæˆ¦ç•¥ã€‘
${actionDesc.split('\n').map(line => '# ' + line).join('\n')}
# 
# ============================================

import numpy as np
import torch
import torch.nn as nn
import torch.optim as optim
import sys
import os
from pathlib import Path

# ä¿®æ­£ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
sys.path.append(str(Path(__file__).parent))
sys.path.append(str(Path(__file__).parent / "src"))
from src.qugeister_competitive.debug_game_viewer import DebugGeisterGame
from src.qugeister_competitive.ai_base import BaseAI

# ===== ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ï¼ˆä¿®æ­£ç‰ˆï¼‰ =====
game_engine = DebugGeisterGame()

# ===== å­¦ç¿’æ–¹æ³•ã®è¨­å®š =====
learning_config = {
    'method': '${config.learningMethod}',
    'algorithm': '${config.learningMethod === 'reinforcement' ? config.qmap : 'supervised'}',
}

# ===== ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š =====
module_config = {
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«1: åˆæœŸé…ç½®ï¼ˆä¿®æ­£ã•ã‚ŒãŸã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œ - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aä¸‹å´é…ç½®ï¼‰
    'placement': {
        'type': '${config.placement}',
        'player_a_bottom': True,    # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Aã¯ä¸‹å´ï¼ˆy=4,5ï¼‰ã«é…ç½®
        'player_b_top': True,       # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Bã¯ä¸Šå´ï¼ˆy=0,1ï¼‰ã«é…ç½®
        'my_pieces_only': np.array([
${config.board.slice(4, 6).map(row => '            ' + JSON.stringify(row.map(val => (val === 1 || val === -1) ? val : 0))).join(',\n')}
        ]),
        'escape_positions': {
            'player_a': [(0, 0), (5, 0)],  # Aè„±å‡ºå£ï¼šç›¸æ‰‹é™£åœ°ï¼ˆä¸Šå´è§’ï¼‰
            'player_b': [(0, 5), (5, 5)]   # Bè„±å‡ºå£ï¼šç›¸æ‰‹é™£åœ°ï¼ˆä¸‹å´è§’ï¼‰
        },
        'coordinate_system': 'corrected',  # ä¿®æ­£ã•ã‚ŒãŸåº§æ¨™ç³»
        'opponent_unknown': True,          # ç›¸æ‰‹ã®é§’é…ç½®ã¯å®Œå…¨ã«æœªçŸ¥
        'rule_compliant': True            # ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ«æº–æ‹ 
    },
    
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«2: æ•µé§’æ¨å®šï¼ˆCQCNNï¼‰
    'quantum': {
        'n_qubits': ${config.qubits},
        'n_layers': ${config.layers},
        'embedding_type': '${config.embedding}',
        'entanglement': '${config.entanglement}',
        'total_params': ${config.qubits * config.layers * 3}
    },
    
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«3: å ±é…¬é–¢æ•°ï¼ˆä¿®æ­£ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«å¯¾å¿œï¼‰
    'reward': {
        'strategy': '${config.reward}',
        'capture_good_reward': ${config.reward === 'aggressive' ? 20 : config.reward === 'defensive' ? 5 : 10},
        'capture_bad_penalty': -5,        # ç›¸æ‰‹ã®æ‚ªç‰ã‚’å–ã‚‹ã“ã¨ã¯ãƒã‚¤ãƒŠã‚¹
        'escape_reward': ${config.reward === 'escape' ? 100 : config.reward === 'defensive' ? 40 : 50},
        'captured_good_penalty': ${config.reward === 'defensive' ? -30 : -20},  # å–„ç‰ã‚’å–ã‚‰ã‚Œã‚‹
        'captured_bad_reward': 10,        # æ‚ªç‰ã‚’å–ã‚‰ã›ã‚‹ï¼ˆæˆ¦ç•¥çš„ï¼‰
        'win_condition_rewards': {
            'escape_win': 100,            # è„±å‡ºå‹åˆ©
            'eliminate_all_good': 100,    # ç›¸æ‰‹å–„ç‰å…¨å–å¾—
            'eliminate_all_bad': 100      # ç›¸æ‰‹æ‚ªç‰å…¨å–ã‚‰ã›
        },
        'position_rewards': {
            'advance_toward_escape': 2,   # è„±å‡ºå£ã¸ã®å‰é€²
            'center_control': 1,          # ä¸­å¤®åˆ¶å¾¡
            'opponent_territory': 3       # ç›¸æ‰‹é™£åœ°ã¸ã®ä¾µå…¥
        }
    },
    
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«4: Qå€¤è¨ˆç®—ï¼ˆä¿®æ­£ã•ã‚ŒãŸã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œï¼‰
    'qmap': {
        'method': '${config.qmap}',
        'state_dim': ${config.stateChannels ? config.stateChannels * 36 : 252},  # 6x6x${config.stateChannels || 7}ãƒãƒ£ãƒ³ãƒãƒ«
        'action_dim': 5,         # 4æ–¹å‘ + è„±å‡º
        'selected_channels': ${config.stateChannels || 7},
        'state_channels': {
            'my_good_pieces': 1,     # è‡ªåˆ†ã®å–„ç‰ä½ç½®
            'my_bad_pieces': 1,      # è‡ªåˆ†ã®æ‚ªç‰ä½ç½®  
            'opponent_pieces': 1,    # ç›¸æ‰‹ã®é§’ä½ç½®ï¼ˆç¨®é¡ä¸æ˜ï¼‰
            'known_opponent_good': 1, # ç¢ºèªæ¸ˆã¿ç›¸æ‰‹å–„ç‰
            'known_opponent_bad': 1,  # ç¢ºèªæ¸ˆã¿ç›¸æ‰‹æ‚ªç‰
            'legal_moves': 1,        # ç§»å‹•å¯èƒ½ä½ç½®
            'escape_positions': 1,   # è„±å‡ºå¯èƒ½ä½ç½®
            ${config.stateChannels >= 12 ? `
            'opponent_escape_routes': 1,  # ç›¸æ‰‹ã®è„±å‡ºçµŒè·¯
            'attack_positions': 1,        # æ”»æ’ƒå¯èƒ½ä½ç½®
            'danger_zones': 1,            # å±é™ºåœ°å¸¯
            'territory_control': 1,       # åˆ¶åœ§é ˜åŸŸ
            'escape_blocking': 1,         # è„±å‡ºé˜»æ­¢ä½ç½®
            ` : ''}
            ${config.stateChannels >= 16 ? `
            'piece_value_map': 1,         # é§’ä¾¡å€¤ãƒãƒƒãƒ—
            'movement_history': 1,        # ç§»å‹•å±¥æ­´
            'turn_phase': 1,              # ã‚²ãƒ¼ãƒ æ®µéš
            'opponent_intention': 1,      # ç›¸æ‰‹æ„å›³æ¨å®š
            ` : ''}
        },
        'legal_moves_only': True, # åˆæ³•æ‰‹ã®ã¿è€ƒæ…®
        'game_engine': 'DebugGeisterGame',  # ä½¿ç”¨ã™ã‚‹ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³
        'move_validation': True   # æ‰‹ã®æœ‰åŠ¹æ€§æ¤œè¨¼
    },
    
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«5: è¡Œå‹•é¸æŠ
    'action': {
        'strategy': '${config.action}',
        'epsilon': ${config.action === 'epsilon' ? hyperparams.epsilon : 'None'},
        'temperature': ${config.action === 'boltzmann' ? '1.0' : 'None'}
    }
}

# ===== ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ =====
hyperparameters = {
    # åŸºæœ¬å­¦ç¿’è¨­å®š
    'learning_rate': ${hyperparams.learningRate},
    'batch_size': ${document.getElementById('batchSize').value},
    'epochs': ${document.getElementById('epochs').value},
    'validation_split': ${hyperparams.validation},
    
    # æœ€é©åŒ–è¨­å®š
    'optimizer': '${document.getElementById('optimizer').value}',
    'scheduler': '${document.getElementById('scheduler').value}',
    'dropout_rate': ${hyperparams.dropout},
    'l2_regularization': ${hyperparams.l2Reg},
    ${config.learningMethod === 'reinforcement' ? `
    # å¼·åŒ–å­¦ç¿’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    'epsilon': ${hyperparams.epsilon},
    'epsilon_decay': ${hyperparams.epsilonDecay},
    'epsilon_min': 0.01,
    'gamma': ${hyperparams.gamma},
    'replay_buffer_size': ${document.getElementById('replayBuffer').value},
    'target_update_freq': 100,` : `
    # æ•™å¸«ã‚ã‚Šå­¦ç¿’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    'dataset_path': '${document.getElementById('datasetPath').value || 'path/to/dataset.csv'}',
    'augmentation': '${document.getElementById('augmentation').value}',
    'class_weight': '${document.getElementById('classWeight').value}',
    'loss_function': '${document.getElementById('lossFunction').value}',`}
}

# ===== ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ï¼ˆä¿®æ­£ã•ã‚ŒãŸã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œï¼‰ =====
class CorrectedQuantumBattleAI(BaseAI, nn.Module):
    def __init__(self, name="QuantumBattleAI", player_id="B"):
        BaseAI.__init__(self, name, player_id)
        nn.Module.__init__(self)
        self.config = module_config
        
        # CQCNNã‚¨ãƒ³ã‚³ãƒ¼ãƒ€
        self.quantum_encoder = self._build_quantum_encoder()
        
        # å¤å…¸çš„ãƒ‡ã‚³ãƒ¼ãƒ€ï¼ˆè„±å‡ºã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
        # å¤å…¸çš„ãƒ‡ã‚³ãƒ¼ãƒ€ï¼ˆè»½é‡åŒ–ç‰ˆï¼‰
        self.classical_decoder = nn.Sequential(
            nn.Linear(self.config['quantum']['n_qubits'], 32),
            nn.ReLU(),
            nn.Linear(32, 5)  # 4æ–¹å‘ + è„±å‡ºã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè»½é‡åŒ–ï¼‰
        )
    
    def get_move(self, game_state, legal_moves):
        """ä¿®æ­£ã•ã‚ŒãŸã‚¨ãƒ³ã‚¸ãƒ³ç”¨ã®æ‰‹é¸æŠï¼ˆBaseAIæŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…ï¼‰"""
        if not legal_moves:
            return None
        
        # è„±å‡ºå¯èƒ½æ‰‹ã‚’æœ€å„ªå…ˆ
        escape_moves = [move for move in legal_moves if isinstance(move[1], str) and move[1] == "ESCAPE"]
        if escape_moves and self.config['reward']['strategy'] == 'escape':
            return escape_moves[0]
        
        # é‡å­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§è©•ä¾¡
        state_tensor = self._encode_game_state(game_state)
        q_values = self.forward(state_tensor)
        
        # åˆæ³•æ‰‹ã®ã¿ã‹ã‚‰é¸æŠ
        best_move = None
        best_value = float('-inf')
        
        for move in legal_moves:
            move_idx = self._move_to_index(move)
            if move_idx < len(q_values) and q_values[move_idx] > best_value:
                best_value = q_values[move_idx]
                best_move = move
        
        return best_move if best_move else legal_moves[0]
    
    def choose_action(self, game_state):
        """human_vs_ai_battle.pyç”¨ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ"""
        legal_moves = game_state.get_legal_moves(self.player_id)
        return self.get_move(game_state, legal_moves)
    
    def _build_quantum_encoder(self):
        # é‡å­å›è·¯ã®æ§‹ç¯‰
        from pennylane import numpy as qnp
        import pennylane as qml
        
        n_qubits = self.config['quantum']['n_qubits']
        n_layers = self.config['quantum']['n_layers']
        
        # lightning.qubitãŒä½¿ãˆãªã„å ´åˆã¯default.qubitã‚’ä½¿ç”¨
        try:
            dev = qml.device('lightning.qubit', wires=n_qubits)
        except (ImportError, Exception):
            dev = qml.device('default.qubit', wires=n_qubits)
        
        @qml.qnode(dev)
        def quantum_circuit(inputs, weights):
            # ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
            for i in range(n_qubits):
                if self.config['quantum']['embedding_type'] == 'angle':
                    qml.RY(inputs[i], wires=i)
                else:
                    qml.RX(inputs[i], wires=i)
            
            # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–é‡å­å›è·¯
            for l in range(n_layers):
                # å›è»¢å±¤
                for i in range(n_qubits):
                    qml.RY(weights[l][i][0], wires=i)
                    qml.RZ(weights[l][i][1], wires=i)
                
                # ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆå±¤
                if self.config['quantum']['entanglement'] == 'linear':
                    for i in range(n_qubits - 1):
                        qml.CNOT(wires=[i, i+1])
                elif self.config['quantum']['entanglement'] == 'full':
                    for i in range(n_qubits):
                        for j in range(i+1, n_qubits):
                            qml.CZ(wires=[i, j])
            
            # æ¸¬å®š
            return [qml.expval(qml.PauliZ(i)) for i in range(n_qubits)]
        
        return quantum_circuit
    
    def _encode_game_state(self, game_state):
        """ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’7ãƒãƒ£ãƒ³ãƒãƒ«ãƒ†ãƒ³ã‚½ãƒ«ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰"""
        import torch
        import numpy as np
        
        # 6x6x7ã®ãƒ†ãƒ³ã‚½ãƒ«ã‚’åˆæœŸåŒ–
        state_tensor = torch.zeros(7, 6, 6)
        
        # ãƒãƒ£ãƒ³ãƒãƒ«0: è‡ªåˆ†ã®å–„ç‰ä½ç½®
        my_pieces = game_state.player_a_pieces if self.player_id == "A" else game_state.player_b_pieces
        for (x, y), piece_type in my_pieces.items():
            if piece_type == "good":
                state_tensor[0, y, x] = 1
        
        # ãƒãƒ£ãƒ³ãƒãƒ«1: è‡ªåˆ†ã®æ‚ªç‰ä½ç½®
        for (x, y), piece_type in my_pieces.items():
            if piece_type == "bad":
                state_tensor[1, y, x] = 1
        
        # ãƒãƒ£ãƒ³ãƒãƒ«2: ç›¸æ‰‹ã®é§’ä½ç½®ï¼ˆç¨®é¡ä¸æ˜ï¼‰
        opponent_pieces = game_state.player_b_pieces if self.player_id == "A" else game_state.player_a_pieces
        for (x, y), piece_type in opponent_pieces.items():
            state_tensor[2, y, x] = 1
        
        # ãƒãƒ£ãƒ³ãƒãƒ«3&4: ç¢ºèªæ¸ˆã¿ç›¸æ‰‹å–„ç‰ãƒ»æ‚ªç‰ï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰
        # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€éå»ã®æ•ç²æƒ…å ±ã‹ã‚‰æ¨å®š
        
        # ãƒãƒ£ãƒ³ãƒãƒ«5: ç§»å‹•å¯èƒ½ä½ç½®
        legal_moves = game_state.get_legal_moves(self.player_id)
        for move in legal_moves:
            if len(move) == 2 and isinstance(move[1], tuple):
                from_pos, to_pos = move
                x, y = to_pos
                state_tensor[5, y, x] = 1
        
        # ãƒãƒ£ãƒ³ãƒãƒ«6: è„±å‡ºå¯èƒ½ä½ç½®
        escape_positions = self.config['placement']['escape_positions']
        if self.player_id in escape_positions:
            for x, y in escape_positions[self.player_id]:
                state_tensor[6, y, x] = 1
        
        return state_tensor.flatten()  # 252æ¬¡å…ƒã«å¹³å¦åŒ–
    
    def _move_to_index(self, move):
        """ç§»å‹•ã‚’è¡Œå‹•ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å¤‰æ›"""
        if len(move) == 2 and move[1] == "ESCAPE":
            return 4  # è„±å‡ºã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        
        # 4æ–¹å‘ç§»å‹•ã‚’0-3ã«ãƒãƒƒãƒ—
        if len(move) == 2:
            from_pos, to_pos = move
            dx = to_pos[0] - from_pos[0]
            dy = to_pos[1] - from_pos[1]
            
            if dx == 0 and dy == -1: return 0  # ä¸Š
            elif dx == 1 and dy == 0: return 1  # å³
            elif dx == 0 and dy == 1: return 2  # ä¸‹
            elif dx == -1 and dy == 0: return 3  # å·¦
        
        return 0  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    
    def _distribute_channels_to_qubits(self, x):
        """7ãƒãƒ£ãƒ³ãƒãƒ«ï¼ˆ252æ¬¡å…ƒï¼‰ã‚’é‡å­ãƒ“ãƒƒãƒˆæ•°ã«å‡ç­‰åˆ†æ•£"""
        import torch
        import numpy as np
        
        n_qubits = self.config['quantum']['n_qubits']
        
        # 252æ¬¡å…ƒã‚’7ãƒãƒ£ãƒ³ãƒãƒ« Ã— 36æ¬¡å…ƒã«åˆ†å‰²
        channels = x.view(7, 36)  # [7ãƒãƒ£ãƒ³ãƒãƒ«, 6Ã—6=36æ¬¡å…ƒ]
        
        # å„ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰ä»£è¡¨å€¤ã‚’æŠ½å‡º
        channel_features = []
        for ch in range(7):
            channel_data = channels[ch]  # 36æ¬¡å…ƒ
            
            # å„ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰é‡è¦ãªç‰¹å¾´ã‚’æŠ½å‡º
            mean_val = channel_data.mean().item()          # å¹³å‡å€¤
            max_val = channel_data.max().item()            # æœ€å¤§å€¤  
            nonzero_count = (channel_data > 0).sum().item() / 36.0  # éã‚¼ãƒ­ç‡
            center_val = channel_data[15:21].mean().item()  # ä¸­å¤®éƒ¨ã®å¹³å‡ï¼ˆæˆ¦ç•¥çš„é‡è¦ã‚¨ãƒªã‚¢ï¼‰
            
            channel_features.extend([mean_val, max_val, nonzero_count, center_val])
        
        # 7ãƒãƒ£ãƒ³ãƒãƒ« Ã— 4ç‰¹å¾´ = 28æ¬¡å…ƒã®ç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«
        feature_vector = torch.tensor(channel_features, dtype=torch.float32)
        
        # é‡å­ãƒ“ãƒƒãƒˆæ•°ã«åˆã‚ã›ã¦èª¿æ•´ï¼ˆ7ãƒãƒ£ãƒ³ãƒãƒ«å¼·åˆ¶å‡ç­‰åˆ†æ•£ï¼‰
        if n_qubits >= 7:
            # é‡å­ãƒ“ãƒƒãƒˆãŒ7ä»¥ä¸Šï¼šå„ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰æœ€ä½1ã¤é¸æŠ
            selections = []
            base_per_channel = n_qubits // 7
            extra = n_qubits % 7
            
            for ch_idx in range(7):
                count = base_per_channel + (1 if ch_idx < extra else 0)
                for i in range(count):
                    feat_idx = i % 4  # ç‰¹å¾´ã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (å¹³å‡â†’æœ€å¤§â†’éã‚¼ãƒ­ç‡â†’ä¸­å¤®)
                    selections.append(ch_idx * 4 + feat_idx)
            
            quantum_input = feature_vector[selections]
        else:
            # é‡å­ãƒ“ãƒƒãƒˆãŒ7æœªæº€ï¼šé‡è¦åº¦é †ã«7ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰é¸æŠ
            priorities = [0, 1, 2, 5, 6, 3, 4]  # è‡ªåˆ†å–„ç‰â†’è‡ªåˆ†æ‚ªç‰â†’æ•µé§’â†’åˆæ³•æ‰‹â†’è„±å‡ºâ†’ç¢ºèªæ¸ˆã¿
            selections = []
            for i in range(n_qubits):
                ch_idx = priorities[i]
                feat_idx = 0  # æœ€é‡è¦ç‰¹å¾´ï¼ˆå¹³å‡å€¤ï¼‰
                selections.append(ch_idx * 4 + feat_idx)
            
            quantum_input = feature_vector[selections]
        
        # é‡å­å›è·¯ç”¨ã«æ­£è¦åŒ–ï¼ˆ0-Ï€ç¯„å›²ï¼‰
        quantum_input = torch.tanh(quantum_input) * np.pi / 2
        
        return quantum_input
    
    def forward(self, x):
        # 7ãƒãƒ£ãƒ³ãƒãƒ«å‡ç­‰åˆ†æ•£é‡å­ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
        weights = torch.randn(self.config['quantum']['n_layers'], self.config['quantum']['n_qubits'], 2) * 0.1
        quantum_input = self._distribute_channels_to_qubits(x)
        quantum_features = torch.tensor(self.quantum_encoder(quantum_input, weights))
        
        # å¤å…¸çš„å‡¦ç†
        output = self.classical_decoder(quantum_features)
        
        return output

# ===== å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹ =====
def train_model(model, config, hyperparameters):
    # ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶è¨­å®š
    if hyperparameters['optimizer'] == 'adam':
        optimizer = optim.Adam(
            model.parameters(), 
            lr=hyperparameters['learning_rate'],
            weight_decay=hyperparameters['l2_regularization']
        )
    elif hyperparameters['optimizer'] == 'sgd':
        optimizer = optim.SGD(
            model.parameters(),
            lr=hyperparameters['learning_rate'],
            momentum=0.9,
            weight_decay=hyperparameters['l2_regularization']
        )
    
    # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©è¨­å®š
    if hyperparameters['scheduler'] == 'cosine':
        scheduler = optim.lr_scheduler.CosineAnnealingLR(
            optimizer, T_max=hyperparameters['epochs']
        )
    elif hyperparameters['scheduler'] == 'step':
        scheduler = optim.lr_scheduler.StepLR(
            optimizer, step_size=30, gamma=0.1
        )
    else:
        scheduler = None
    
    ${config.learningMethod === 'reinforcement' ? `# å¼·åŒ–å­¦ç¿’ãƒ«ãƒ¼ãƒ—
    from collections import deque
    import random
    
    # ãƒªãƒ—ãƒ¬ã‚¤ãƒãƒƒãƒ•ã‚¡
    replay_buffer = deque(maxlen=hyperparameters['replay_buffer_size'])
    
    # Îµ-greedy ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    epsilon = hyperparameters['epsilon']
    
    for episode in range(hyperparameters['epochs']):
        state = system.reset()
        total_reward = 0
        done = False
        
        while not done:
            # è¡Œå‹•é¸æŠ
            if random.random() < epsilon:
                action = random.choice(range(4))
            else:
                with torch.no_grad():
                    q_values = model(state)
                    action = q_values.argmax().item()
            
            # ç’°å¢ƒã¨ã®ç›¸äº’ä½œç”¨
            next_state, reward, done = system.step(action)
            
            # ãƒªãƒ—ãƒ¬ã‚¤ãƒãƒƒãƒ•ã‚¡ã«ä¿å­˜
            replay_buffer.append((state, action, reward, next_state, done))
            
            # ãƒŸãƒ‹ãƒãƒƒãƒå­¦ç¿’
            if len(replay_buffer) >= hyperparameters['batch_size']:
                batch = random.sample(replay_buffer, hyperparameters['batch_size'])
                states, actions, rewards, next_states, dones = zip(*batch)
                
                # Qå€¤ã®è¨ˆç®—ã¨æ›´æ–°
                current_q = model(torch.tensor(states))
                next_q = model(torch.tensor(next_states))
                target_q = rewards + hyperparameters['gamma'] * next_q.max(1)[0] * (1 - dones)
                
                loss = nn.MSELoss()(current_q.gather(1, actions), target_q)
                
                optimizer.zero_grad()
                loss.backward()
                optimizer.step()
            
            state = next_state
            total_reward += reward
        
        # Îµã®æ¸›è¡°
        epsilon = max(0.01, epsilon * hyperparameters['epsilon_decay'])
        
        # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©æ›´æ–°
        if scheduler:
            scheduler.step()
        
        print(f"Episode {episode}: Total Reward = {total_reward:.2f}, Îµ = {epsilon:.4f}")` : `# æ•™å¸«ã‚ã‚Šå­¦ç¿’ãƒ«ãƒ¼ãƒ—
    from torch.utils.data import DataLoader, TensorDataset
    import pandas as pd
    
    # ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿
    data = pd.read_csv(hyperparameters['dataset_path'])
    X_train = torch.tensor(data.iloc[:, :-1].values, dtype=torch.float32)
    y_train = torch.tensor(data.iloc[:, -1].values, dtype=torch.long)
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼ä½œæˆ
    dataset = TensorDataset(X_train, y_train)
    train_size = int((1 - hyperparameters['validation_split']) * len(dataset))
    val_size = len(dataset) - train_size
    train_dataset, val_dataset = torch.utils.data.random_split(dataset, [train_size, val_size])
    
    train_loader = DataLoader(train_dataset, batch_size=hyperparameters['batch_size'], shuffle=True)
    val_loader = DataLoader(val_dataset, batch_size=hyperparameters['batch_size'])
    
    # æå¤±é–¢æ•°
    if hyperparameters['loss_function'] == 'cross_entropy':
        criterion = nn.CrossEntropyLoss()
    elif hyperparameters['loss_function'] == 'mse':
        criterion = nn.MSELoss()
    
    # å­¦ç¿’ãƒ«ãƒ¼ãƒ—
    for epoch in range(hyperparameters['epochs']):
        # è¨“ç·´ãƒ•ã‚§ãƒ¼ã‚º
        model.train()
        train_loss = 0
        train_correct = 0
        
        for batch_x, batch_y in train_loader:
            optimizer.zero_grad()
            outputs = model(batch_x)
            loss = criterion(outputs, batch_y)
            loss.backward()
            optimizer.step()
            
            train_loss += loss.item()
            _, predicted = torch.max(outputs.data, 1)
            train_correct += (predicted == batch_y).sum().item()
        
        # æ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚º
        model.eval()
        val_loss = 0
        val_correct = 0
        
        with torch.no_grad():
            for batch_x, batch_y in val_loader:
                outputs = model(batch_x)
                loss = criterion(outputs, batch_y)
                
                val_loss += loss.item()
                _, predicted = torch.max(outputs.data, 1)
                val_correct += (predicted == batch_y).sum().item()
        
        # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©æ›´æ–°
        if scheduler:
            scheduler.step()
        
        print(f"Epoch {epoch}/{hyperparameters['epochs']}")
        print(f"Train Loss: {train_loss/len(train_loader):.4f}, Train Acc: {train_correct/train_size:.4f}")
        print(f"Val Loss: {val_loss/len(val_loader):.4f}, Val Acc: {val_correct/val_size:.4f}")`}
    
    return model

# ===== ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ =====
if __name__ == "__main__":
    # ãƒ¢ãƒ‡ãƒ«åˆæœŸåŒ–
    model = CorrectedQuantumBattleAI()
    
    print("========================================")
    print("Quantum Battle System - Training Started")
    print("========================================")
    print("å­¦ç¿’æ–¹æ³•: å¼·åŒ–å­¦ç¿’")
    print(f"é‡å­ãƒ“ãƒƒãƒˆæ•°: {module_config['quantum']['n_qubits']}")
    print(f"ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: {module_config['quantum']['n_layers']}")
    print(f"ç·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°: {sum(p.numel() for p in model.parameters())}")
    print("========================================")
    
    # å­¦ç¿’å®Ÿè¡Œ
    trained_model = train_model(model, module_config, hyperparameters)
    
    # ãƒ¢ãƒ‡ãƒ«ä¿å­˜
    torch.save({
        'model_state_dict': trained_model.state_dict(),
        'module_config': module_config,
        'hyperparameters': hyperparameters,
        'learning_method': learning_config
    }, 'quantum_battle_model.pth')
    
    print("\\n========================================")
    print("Training Complete! Model saved as 'quantum_battle_model.pth'")
    print("========================================")`;

            document.getElementById('generatedCode').textContent = code;
            document.getElementById('codeOutput').style.display = 'block';
            
            // è¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆPlaygroundé€£æºç”¨ï¼‰
            const playgroundConfig = {
                source: '3step_system',
                timestamp: new Date().toISOString(),
                config: config,
                hyperparameters: {
                    batchSize: batchSize,
                    epochs: epochs,
                    optimizer: optimizer,
                    scheduler: scheduler,
                    replayBuffer: replayBuffer
                },
                descriptions: {
                    placement: placementDesc,
                    quantum: quantumDesc,
                    reward: rewardDesc,
                    qmap: qmapDesc,
                    action: actionDesc
                }
            };
            localStorage.setItem('3step_config', JSON.stringify(playgroundConfig));
            
            // Playgroundã¸ç§»å‹•ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            showPlaygroundButton();
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('codeOutput').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Playgroundã¸ç§»å‹•ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        function showPlaygroundButton() {
            const existingBtn = document.getElementById('goToPlayground');
            if (!existingBtn) {
                const btn = document.createElement('button');
                btn.id = 'goToPlayground';
                btn.className = 'btn btn-primary';
                btn.style.marginTop = '20px';
                btn.innerHTML = 'ğŸ¨ Playgroundã§è©³ç´°è¨­è¨ˆ â†’';
                btn.onclick = () => {
                    window.open('quantum_ai_playground.html', '_blank');
                };
                document.getElementById('codeOutput').appendChild(btn);
            }
        }

        // ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }

    </script>
    <!-- <script src="scripts.js"></script> å¤–éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸è¦ -->
</body>
</html>