<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum AI Playground - Simple</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            overflow-y: auto;
        }
        
        .main-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
        }
        
        .sidebar-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2196F3;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background: #1976D2;
        }
        
        .btn-success {
            background: #4CAF50;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-warning {
            background: #FF9800;
        }
        
        .btn-warning:hover {
            background: #F57C00;
        }
        
        .config-display {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .notification.success {
            background: #4CAF50;
        }
        
        .notification.error {
            background: #f44336;
        }
        
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .test-output {
            background: #263238;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-title">ğŸ”¬ Quantum Configuration</div>
            
            <div class="control-group">
                <label>é‡å­ãƒ“ãƒƒãƒˆæ•°: <span id="qubit-count">8</span></label>
                <input type="range" class="slider" id="qubit-slider" 
                       min="4" max="16" value="8" 
                       oninput="updateQubits(this.value)">
            </div>
            
            <div class="control-group">
                <label>å±¤æ•°: <span id="layer-count">3</span></label>
                <input type="range" class="slider" id="layer-slider" 
                       min="1" max="8" value="3" 
                       oninput="updateLayers(this.value)">
            </div>
            
            <div class="control-group">
                <label>ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆ:</label>
                <select id="entanglement-select" onchange="updateEntanglement()">
                    <option value="linear">Linear</option>
                    <option value="circular">Circular</option>
                    <option value="full">Full</option>
                </select>
            </div>
            
            <div class="config-display" id="config-display">
                Config will appear here...
            </div>
            
            <div class="sidebar-title">ğŸ”— ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (åŒæ–¹å‘)</div>
            
            <div class="control-group">
                <button class="btn" style="width: 100%; margin-bottom: 8px;" onclick="exportToComposer()">
                    ğŸŒ IBM Quantum Composerã¸ â†’
                </button>
                <button class="btn btn-success" style="width: 100%;" onclick="importFromComposer()">
                    ğŸ“¥ â† Composerã‹ã‚‰è¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                </button>
            </div>
            
            <div class="sidebar-title">ğŸ› ãƒ‡ãƒãƒƒã‚°</div>
            
            <div class="control-group">
                <button class="btn btn-warning" style="width: 100%;" onclick="runDebugTests()">
                    ğŸ› ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <h1>ğŸŒŒ Quantum AI Playground (Simple)</h1>
            <p>é‡å­å›è·¯è¨­å®šã¨IBM Quantum Composerã¨ã®åŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼</p>
            
            <div id="current-config" class="config-display">
                ç¾åœ¨ã®è¨­å®šãŒè¡¨ç¤ºã•ã‚Œã¾ã™...
            </div>
            
            <div class="test-output" id="test-output" style="display: none;"></div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
        let currentConfig = {
            qubits: 8,
            layers: 3,
            entanglement: 'linear'
        };

        // è¨­å®šã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ç¾¤
        function updateQubits(value) {
            currentConfig.qubits = parseInt(value);
            document.getElementById('qubit-count').textContent = value;
            updateConfigDisplay();
        }

        function updateLayers(value) {
            currentConfig.layers = parseInt(value);
            document.getElementById('layer-count').textContent = value;
            updateConfigDisplay();
        }

        function updateEntanglement() {
            const select = document.getElementById('entanglement-select');
            currentConfig.entanglement = select.value;
            updateConfigDisplay();
        }

        function updateConfigDisplay() {
            const configDiv = document.getElementById('config-display');
            configDiv.innerHTML = `
                <strong>Current Config:</strong><br>
                Qubits: ${currentConfig.qubits}<br>
                Layers: ${currentConfig.layers}<br>
                Entanglement: ${currentConfig.entanglement}
            `;

            const mainConfigDiv = document.getElementById('current-config');
            mainConfigDiv.innerHTML = `
                <strong>é‡å­å›è·¯è¨­å®š:</strong><br>
                ğŸ”¬ é‡å­ãƒ“ãƒƒãƒˆæ•°: ${currentConfig.qubits}<br>
                ğŸ“š å±¤æ•°: ${currentConfig.layers}<br>
                ğŸ”— ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆ: ${currentConfig.entanglement}<br>
                ğŸ“Š æ¨å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°: ${currentConfig.qubits * currentConfig.layers * 2}
            `;
        }

        // QASMç”Ÿæˆé–¢æ•°
        function generateOpenQASM(qubits, layers, entanglement) {
            let qasm = `OPENQASM 2.0;
include "qelib1.inc";

qreg q[${qubits}];
creg c[${qubits}];

// Quantum AI Circuit - ${layers} layers, ${entanglement} entanglement
`;

            for (let layer = 0; layer < layers; layer++) {
                qasm += `\\n// Layer ${layer + 1}\\n`;
                
                // å›è»¢ã‚²ãƒ¼ãƒˆ
                for (let i = 0; i < qubits; i++) {
                    qasm += `ry(theta_${layer}_${i}) q[${i}];\\n`;
                    qasm += `rz(phi_${layer}_${i}) q[${i}];\\n`;
                }
                
                // ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆ
                if (entanglement === 'linear') {
                    for (let i = 0; i < qubits - 1; i++) {
                        qasm += `cx q[${i}], q[${i+1}];\\n`;
                    }
                } else if (entanglement === 'circular') {
                    for (let i = 0; i < qubits - 1; i++) {
                        qasm += `cx q[${i}], q[${i+1}];\\n`;
                    }
                    qasm += `cx q[${qubits-1}], q[0];\\n`;
                } else if (entanglement === 'full') {
                    for (let i = 0; i < qubits; i++) {
                        for (let j = i + 1; j < qubits; j++) {
                            qasm += `cz q[${i}], q[${j}];\\n`;
                        }
                    }
                }
                qasm += '\\n';
            }

            // æ¸¬å®š
            qasm += '// Measurement\\n';
            for (let i = 0; i < qubits; i++) {
                qasm += `measure q[${i}] -> c[${i}];\\n`;
            }

            return qasm;
        }

        // QASMãƒ‘ãƒ¼ã‚·ãƒ³ã‚°é–¢æ•°
        function parseQASMToConfig(qasmCode) {
            const config = {
                qubits: 8,
                layers: 3,
                entanglement: 'linear'
            };
            
            try {
                if (!qasmCode || typeof qasmCode !== 'string') {
                    throw new Error('Invalid QASM code provided');
                }
                
                // é‡å­ãƒ“ãƒƒãƒˆæ•°ã‚’æŠ½å‡º
                const qubitMatch = qasmCode.match(/qreg\\s+q\\[(\\d+)\\]/);
                if (qubitMatch) {
                    const qubits = parseInt(qubitMatch[1]);
                    if (qubits > 0 && qubits <= 32) {
                        config.qubits = qubits;
                    }
                }
                
                // å±¤æ•°ã‚’æ¨å®š
                const rotationGates = qasmCode.match(/r[xyz]\\(/g);
                if (rotationGates && rotationGates.length > 0) {
                    const totalRotations = rotationGates.length;
                    const estimatedLayers = Math.ceil(totalRotations / (config.qubits * 2));
                    config.layers = Math.max(1, Math.min(estimatedLayers, 10));
                }
                
                // ã‚¨ãƒ³ã‚¿ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
                const cxGates = qasmCode.match(/cx\\s+q\\[\\d+\\],\\s*q\\[\\d+\\]/g) || [];
                const czGates = qasmCode.match(/cz\\s+q\\[\\d+\\],\\s*q\\[\\d+\\]/g) || [];
                
                if (czGates.length > cxGates.length) {
                    config.entanglement = 'full';
                } else if (cxGates.length > 0) {
                    const circularPattern = new RegExp(`cx\\\\s+q\\\\[${config.qubits-1}\\\\],\\\\s*q\\\\[0\\\\]`);
                    if (circularPattern.test(qasmCode)) {
                        config.entanglement = 'circular';
                    } else {
                        config.entanglement = 'linear';
                    }
                }
                
                return config;
                
            } catch (error) {
                throw new Error(`QASMè§£æã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // è¨­å®šã‚’é©ç”¨
        function applyConfig(config) {
            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’æ›´æ–°
            document.getElementById('qubit-slider').value = config.qubits;
            document.getElementById('layer-slider').value = config.layers;
            document.getElementById('entanglement-select').value = config.entanglement;
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã‚’æ›´æ–°
            currentConfig = {...config};
            
            // è¡¨ç¤ºã‚’æ›´æ–°
            updateQubits(config.qubits);
            updateLayers(config.layers);
            updateEntanglement();
        }

        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), type === 'error' ? 5000 : 3000);
        }

        // ãƒ­ã‚°å‡ºåŠ›
        function log(message, type = 'info') {
            const output = document.getElementById('test-output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            output.textContent += `[${timestamp}] ${prefix} ${message}\\n`;
            output.scrollTop = output.scrollHeight;
            output.style.display = 'block';
        }

        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function exportToComposer() {
            const qasm = generateOpenQASM(currentConfig.qubits, currentConfig.layers, currentConfig.entanglement);
            
            const newWindow = window.open("", "_blank");
            newWindow.document.write(`
                <html>
                <head>
                    <title>IBM Quantum Composer Export</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .qasm-content { background: #f5f5f5; padding: 20px; border-radius: 5px; white-space: pre-wrap; }
                        button { background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
                    </style>
                </head>
                <body>
                    <h1>ğŸ”¬ IBM Quantum Composer Export</h1>
                    <p>ä»¥ä¸‹ã®QASMã‚³ãƒ¼ãƒ‰ã‚’IBM Quantum Composerã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚</p>
                    
                    <button onclick="copyToClipboard()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    <button onclick="sendBackToPlayground()">ğŸ”„ çµæœã‚’æˆ»ã™</button>
                    
                    <div class="qasm-content" id="qasm-content">${qasm}</div>
                    
                    <script>
                        function copyToClipboard() {
                            const content = document.getElementById('qasm-content').textContent;
                            navigator.clipboard.writeText(content).then(() => {
                                alert('QASMã‚³ãƒ¼ãƒ‰ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼');
                            });
                        }
                        
                        function sendBackToPlayground() {
                            const qasmCode = prompt('ç·¨é›†ã—ãŸQASMã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„:', '');
                            if (qasmCode && qasmCode.trim()) {
                                if (window.opener && !window.opener.closed) {
                                    window.opener.postMessage({
                                        type: 'COMPOSER_QASM_IMPORT',
                                        qasm: qasmCode
                                    }, '*');
                                    alert('ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼');
                                    window.close();
                                } else {
                                    alert('Playgroundã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                                }
                            }
                        }
                    </scr` + `ipt>
                </body>
                </html>
            `);
            
            showNotification('Composerã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãã¾ã—ãŸ');
        }

        // ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function importFromComposer() {
            const qasmCode = prompt('IBM Quantum Composerã‹ã‚‰QASMã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„:', '');
            if (qasmCode && qasmCode.trim()) {
                try {
                    const config = parseQASMToConfig(qasmCode);
                    applyConfig(config);
                    showNotification('è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼');
                } catch (error) {
                    showNotification('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                }
            }
        }

        // ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ
        function runDebugTests() {
            document.getElementById('test-output').textContent = '';
            log('=== ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            try {
                // åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
                log('1. åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ');
                const qasm = generateOpenQASM(4, 2, 'linear');
                log(`QASMç”ŸæˆæˆåŠŸ (${qasm.length}æ–‡å­—)`, 'success');
                
                // ãƒ‘ãƒ¼ã‚·ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
                log('2. QASMãƒ‘ãƒ¼ã‚·ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ');
                const config = parseQASMToConfig(qasm);
                log(`ãƒ‘ãƒ¼ã‚·ãƒ³ã‚°æˆåŠŸ: ${JSON.stringify(config)}`, 'success');
                
                // UIè¦ç´ ãƒ†ã‚¹ãƒˆ
                log('3. UIè¦ç´ ãƒ†ã‚¹ãƒˆ');
                const elements = ['qubit-slider', 'layer-slider', 'entanglement-select'];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    log(`${id}: ${element ? 'âœ…' : 'âŒ'}`);
                });
                
                // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
                log('4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ');
                try {
                    parseQASMToConfig('invalid');
                } catch (e) {
                    log('ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ­£å¸¸', 'success');
                }
                
                log('=== å…¨ãƒ†ã‚¹ãƒˆå®Œäº† ===', 'success');
                showNotification('ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                
            } catch (error) {
                log(`ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                showNotification('ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒŠãƒ¼
        window.addEventListener('message', (event) => {
            if (event.data.type === 'COMPOSER_QASM_IMPORT') {
                try {
                    const config = parseQASMToConfig(event.data.qasm);
                    applyConfig(config);
                    showNotification('Composerã‹ã‚‰è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼');
                } catch (error) {
                    showNotification('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                }
            }
        });

        // åˆæœŸåŒ–
        window.onload = function() {
            updateConfigDisplay();
            showNotification('Quantum AI Playground ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼');
        };
    </script>
</body>
</html>